<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GuardianCheck | AI Anti-Scam Detector</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons (via CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        :root {
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --bg-dark: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #334155;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem;
            flex: 1;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary);
        }

        .settings-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .settings-btn:hover {
            border-color: var(--primary);
            color: var(--text-main);
        }

        /* Hero/Search Area */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #60a5fa, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-container {
            position: relative;
            max-width: 650px;
            margin: 2rem auto;
        }

        .search-input {
            width: 100%;
            padding: 1.25rem 1.5rem;
            padding-right: 120px;
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 16px;
            color: white;
            font-size: 1.1rem;
            transition: 0.3s;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.2);
        }

        .analyze-btn {
            position: absolute;
            right: 8px;
            top: 8px;
            bottom: 8px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }

        .analyze-btn:hover {
            background: var(--primary-hover);
        }

        /* Results Area */
        #results-area {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-out;
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid var(--border);
            margin-bottom: 2rem;
        }

        .risk-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }

        .risk-badge {
            padding: 0.5rem 1.5rem;
            border-radius: 99px;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.875rem;
        }

        .badge-safe { background: rgba(34, 197, 94, 0.1); color: var(--success); border: 1px solid var(--success); }
        .badge-suspicious { background: rgba(245, 158, 11, 0.1); color: var(--warning); border: 1px solid var(--warning); }
        .badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }

        .risk-meter {
            height: 12px;
            background: #334155;
            border-radius: 6px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .risk-meter-fill {
            height: 100%;
            width: 0%;
            transition: width 1s ease-in-out;
        }

        .grid-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .info-item {
            background: rgba(15, 23, 42, 0.5);
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .info-label {
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        /* Loading Animation */
        .loader {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(37, 99, 235, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        /* Settings Modal */
        #settings-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--border);
        }

        .input-group {
            margin: 1.5rem 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-muted);
        }

        .input-group input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
        }

        /* Footer */
        footer {
            padding: 2rem;
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border);
        }

        .disclaimer {
            max-width: 700px;
            margin: 1rem auto;
            padding: 1rem;
            background: rgba(239, 68, 68, 0.05);
            border-radius: 8px;
            border: 1px dashed var(--danger);
            color: #fca5a5;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 600px) {
            .grid-info { grid-template-columns: 1fr; }
            .hero h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="logo">
                <i data-lucide="shield-check"></i>
                GuardianCheck
            </div>
            <button class="settings-btn" onclick="toggleSettings()">
                <i data-lucide="settings"></i>
            </button>
        </header>

        <main>
            <section class="hero">
                <h1>Detect Scams Before They Strike</h1>
                <p style="color: var(--text-muted)">Verify websites and phone numbers using AI-powered threat analysis.</p>
                
                <div class="search-container">
                    <input type="text" id="userInput" class="search-input" placeholder="Enter URL (e.g., bank-login.top) or Phone number...">
                    <button class="analyze-btn" onclick="performAnalysis()">Analyze</button>
                </div>
            </section>

            <!-- Loading State -->
            <div id="loader" class="loader">
                <div class="spinner"></div>
                <p>AI is scanning for threats...</p>
            </div>

            <!-- Results Section -->
            <section id="results-area">
                <div class="result-card">
                    <div class="risk-header">
                        <div>
                            <h2 id="result-title">Analysis Result</h2>
                            <p id="check-timestamp" class="info-label" style="margin-top: 5px;"></p>
                        </div>
                        <div id="risk-badge" class="risk-badge">SAFE</div>
                    </div>

                    <div class="risk-meter">
                        <div id="risk-meter-fill" class="risk-meter-fill"></div>
                    </div>
                    <p id="risk-score-text" style="font-weight: 600; margin-bottom: 1.5rem;"></p>

                    <div class="info-item" style="margin-bottom: 1.5rem; border-left: 4px solid var(--primary);">
                        <div class="info-label"><i data-lucide="bot"></i> AI CONCLUSION</div>
                        <p id="ai-conclusion">Analyzing...</p>
                    </div>

                    <div class="grid-info">
                        <div class="info-item">
                            <div class="info-label"><i data-lucide="search"></i> HEURISTIC FINDINGS</div>
                            <ul id="heuristic-list" style="padding-left: 1.2rem; font-size: 0.9rem;">
                                <!-- Findings injected here -->
                            </ul>
                        </div>
                        <div class="info-item">
                            <div class="info-label"><i data-lucide="alert-triangle"></i> SAFETY ADVICE</div>
                            <p id="safety-advice" style="font-size: 0.9rem;"></p>
                        </div>
                    </div>

                    <div id="firebase-status" style="margin-top: 1.5rem; font-size: 0.75rem; text-align: right; color: var(--text-muted);">
                        <!-- Firebase log status -->
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <div class="disclaimer">
                <strong>Legal Disclaimer:</strong> This tool provides risk assessment based on automated algorithms and AI. It is not a definitive legal judgment. Always exercise caution when sharing personal information online.
            </div>
            <p>&copy; 2025 GuardianCheck Security. Built for a safer web.</p>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" onclick="if(event.target === this) toggleSettings()">
        <div class="modal-content">
            <h3>Analysis Settings</h3>
            <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">Keys are stored locally in your browser.</p>
            
            <div class="input-group">
                <label>OpenAI/Groq API Key</label>
                <input type="password" id="apiKey" placeholder="sk-...">
            </div>

            <div class="input-group">
                <label>Custom Endpoint (Optional)</label>
                <input type="text" id="apiEndpoint" placeholder="https://api.openai.com/v1">
            </div>

            <button class="analyze-btn" style="position: static; width: 100%;" onclick="saveSettings()">Save Configuration</button>
        </div>
    </div>

    <!-- Firebase SDK (Optional Integration) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // --- 1. CONFIGURATION & INITIALIZATION ---
        lucide.createIcons();

        // Firebase Config Placeholder (User can fill this)
        const firebaseConfig = {
            apiKey: "AIzaSyCLCcgaoW9gNYhKk0c0gDWC6i5mKVTN4XE",
            authDomain: "profile-d1214.firebaseapp.com",
            projectId: "profile-d1214",
            storageBucket: "profile-d1214.firebasestorage.app",
            messagingSenderId: "914980131889",
            appId: "1:914980131889:web:72f8da15c42dbee671b110",
        };

        // Initialize Firebase if config is valid
        let db = null;
        if (firebaseConfig.apiKey !== "YOUR_FIREBASE_API_KEY") {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
            } catch (e) { console.error("Firebase init failed", e); }
        }

        function toggleSettings() {
            const modal = document.getElementById('settings-modal');
            modal.style.display = (modal.style.display === 'flex') ? 'none' : 'flex';
            if(modal.style.display === 'flex') {
                document.getElementById('apiKey').value = localStorage.getItem('gc_api_key') || '';
                document.getElementById('apiEndpoint').value = localStorage.getItem('gc_api_endpoint') || 'https://api.openai.com/v1';
            }
        }

        function saveSettings() {
            localStorage.setItem('gc_api_key', document.getElementById('apiKey').value);
            localStorage.setItem('gc_api_endpoint', document.getElementById('apiEndpoint').value);
            toggleSettings();
            alert('Settings saved locally.');
        }

        // --- 2. INPUT DETECTION & VALIDATION ---
        function detectType(input) {
            const urlPattern = /^(https?:\/\/)?([\w\d-]+\.)+[\w-]{2,}(\/.*)?$/i;
            const phonePattern = /^(\+?\d{1,3})?[-.\s]?\(?\d{3}\)?[-.\s]?\d{3}[-.\s]?\d{4}$/;

            if (urlPattern.test(input)) return 'URL';
            if (phonePattern.test(input)) return 'PHONE';
            return 'UNKNOWN';
        }

        // --- 3. CORE ANALYSIS LOGIC ---
        async function performAnalysis() {
            const input = document.getElementById('userInput').value.trim();
            const type = detectType(input);

            if (!input) return alert("Please enter a URL or Phone number.");
            if (type === 'UNKNOWN') return alert("Unrecognized format. Please provide a valid URL or Phone number.");

            // UI State: Loading
            document.getElementById('loader').style.display = 'block';
            document.getElementById('results-area').style.display = 'none';

            // Gather Heuristics
            const heuristics = runHeuristics(input, type);
            
            // Call AI Analysis
            const aiResult = await callAI(input, type, heuristics);

            // Update UI
            displayResults(input, type, heuristics, aiResult);
            
            // Optional: Save to Firebase
            saveResultToFirebase(input, type, aiResult);
        }

        function runHeuristics(input, type) {
            let findings = [];
            let baseScore = 0;

            if (type === 'URL') {
                const url = input.toLowerCase();
                if (!url.startsWith('https://')) {
                    findings.push("No HTTPS encryption detected.");
                    baseScore += 30;
                }
                const suspiciousTlds = ['.xyz', '.top', '.pw', '.bid', '.monster', '.icu'];
                if (suspiciousTlds.some(tld => url.endsWith(tld) || url.includes(tld + '/'))) {
                    findings.push("Uses a low-reputation TLD often associated with spam.");
                    baseScore += 25;
                }
                const scamKeywords = ['login', 'verify', 'secure', 'bank', 'update', 'account', 'gift', 'prize'];
                if (scamKeywords.some(word => url.includes(word))) {
                    findings.push("Contains keywords commonly used in phishing (e.g., 'login', 'bank').");
                    baseScore += 15;
                }
                if (input.includes('xn--')) {
                    findings.push("Punycode detected (possible homograph attack/fake characters).");
                    baseScore += 40;
                }
            } else {
                // Phone Heuristics
                if (input.length < 8) findings.push("Number is suspiciously short.");
                if (input.startsWith('+')) baseScore += 5; // Global numbers are neutral but noted
                findings.push("Pattern analysis: Standard formatting check complete.");
            }

            return { findings, baseScore };
        }

        // --- 4. AI INTEGRATION ---
        async function callAI(input, type, heuristics) {
            const apiKey = localStorage.getItem('gc_api_key');
            const endpoint = localStorage.getItem('gc_api_endpoint') || 'https://api.openai.com/v1';

            if (!apiKey) {
                return {
                    score: Math.min(heuristics.baseScore, 100),
                    level: heuristics.baseScore > 50 ? 'Suspicious' : 'Safe',
                    conclusion: "AI Analysis skipped (No API Key). Based on heuristics: " + 
                               (heuristics.findings[0] || "No immediate red flags."),
                    advice: "Please set your API key in settings for deep AI inspection."
                };
            }

            const prompt = `You are a cybersecurity expert. Analyze this ${type}: "${input}". 
            Heuristic findings: ${heuristics.findings.join(', ')}. 
            Return ONLY a JSON object with: 
            { "score": (0-100), "level": ("Safe", "Suspicious", "High Risk"), "conclusion": "short explanation", "advice": "safety tip" }`;

            try {
                const response = await fetch(`${endpoint}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: "gpt-3.5-turbo", // Or groq equivalent
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.3
                    })
                });

                const data = await response.json();
                return JSON.parse(data.choices[0].message.content);
            } catch (e) {
                console.error("AI Error:", e);
                return { score: 50, level: "Unknown", conclusion: "AI Analysis failed to connect.", advice: "Check your API settings." };
            }
        }

        // --- 5. UI RENDERING ---
        function displayResults(input, type, heuristics, ai) {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('results-area').style.display = 'block';

            // Title and Timestamp
            document.getElementById('result-title').innerText = `${type} Check: ${input}`;
            document.getElementById('check-timestamp').innerText = `Analyzed on: ${new Date().toLocaleString()}`;

            // Risk Badge
            const badge = document.getElementById('risk-badge');
            badge.innerText = ai.level;
            badge.className = 'risk-badge ' + 
                (ai.level === 'Safe' ? 'badge-safe' : ai.level === 'Suspicious' ? 'badge-suspicious' : 'badge-danger');

            // Risk Meter
            const meterFill = document.getElementById('risk-meter-fill');
            meterFill.style.width = ai.score + '%';
            meterFill.style.backgroundColor = ai.score < 40 ? 'var(--success)' : ai.score < 75 ? 'var(--warning)' : 'var(--danger)';
            document.getElementById('risk-score-text').innerText = `Risk Score: ${ai.score}/100`;

            // Text content
            document.getElementById('ai-conclusion').innerText = ai.conclusion;
            document.getElementById('safety-advice').innerText = ai.advice;

            // Heuristic list
            const hList = document.getElementById('heuristic-list');
            hList.innerHTML = heuristics.findings.map(f => `<li>${f}</li>`).join('') || "<li>No automated red flags detected in formatting.</li>";
        }

        // --- 6. DATA PERSISTENCE ---
        async function saveResultToFirebase(input, type, result) {
            if (!db) return;
            
            try {
                await db.collection("analysis_logs").add({
                    input,
                    type,
                    score: result.score,
                    level: result.level,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                document.getElementById('firebase-status').innerText = "Result synced to secure cloud storage.";
            } catch (e) {
                console.warn("Firebase logging failed", e);
            }
        }
    </script>
</body>
</html>
