<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng B√°o C√°o Y T·∫ø Tuy·∫øn C∆° S·ªü</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #10b981;
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --text-main: #1e293b;
            --border-radius: 12px;
        }

        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body {
            background: var(--bg-gradient);
            background-attachment: fixed;
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container { max-width: 1000px; margin: 0 auto; }

        /* Header & Sticky Top Bar */
        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 { color: #1e3a8a; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }

        .sticky-nav {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 30px;
            position: sticky;
            top: 10px;
            z-index: 100;
            border: 1px solid #e2e8f0;
        }

        .form-control {
            padding: 10px 15px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
        }

        .form-control:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        /* Card Style */
        .card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            border: 1px solid #f1f5f9;
            transition: transform 0.2s;
        }

        .card:hover { transform: translateY(-2px); }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e40af;
            margin-bottom: 20px;
            border-bottom: 2px solid #dbeafe;
            padding-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Module A1 Grid */
        .grid-khom {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .khom-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .khom-item label { font-size: 0.85rem; font-weight: 600; color: #475569; }

        .input-group-custom {
            display: flex;
            align-items: center;
            background: #f8fafc;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
        }

        .input-group-custom input {
            width: 100%;
            border: none;
            background: transparent;
            padding: 8px;
            text-align: right;
        }

        .input-group-custom span { padding: 0 8px; color: #64748b; font-weight: 600; }

        /* Table Style */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #e2e8f0; padding: 12px; text-align: center; }
        th { background: #f8fafc; color: #334155; font-size: 0.9rem; }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            border: none;
        }

        .btn-add { background: #0ea5e9; color: white; margin-top: 10px; }
        .btn-add:hover { background: #0284c7; }

        .btn-save {
            background: #059669;
            color: white;
            width: 100%;
            font-size: 1.1rem;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(5, 150, 105, 0.3);
        }

        .btn-save:hover { background: #047857; transform: scale(1.01); }

        .total-badge {
            background: #dcfce7;
            color: #166534;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .sticky-nav { flex-direction: column; }
            .grid-khom { grid-template-columns: 1fr 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>B√°o C√°o Ho·∫°t ƒê·ªông Y T·∫ø</h1>
        <p>Trung t√¢m Y t·∫ø Th√†nh ph·ªë B·∫°c Li√™u</p>
    </div>

    <!-- PH·∫¶N CH·ªåN ƒê∆†N V·ªä & TH√ÅNG -->
    <div class="sticky-nav">
        <div style="display:flex; flex-direction:column; gap:5px;">
            <label>ƒê∆°n v·ªã b√°o c√°o:</label>
            <select id="donVi" class="form-control" required>
                <option value="">-- Ch·ªçn ƒë∆°n v·ªã --</option>
                <option value="Nh√† M√°t">Ph∆∞·ªùng Nh√† M√°t</option>
                <option value="Hi·ªáp Th√†nh">X√£ Hi·ªáp Th√†nh</option>
                <option value="Vƒ©nh Tr·∫°ch ƒê√¥ng">X√£ Vƒ©nh Tr·∫°ch ƒê√¥ng</option>
            </select>
        </div>
        <div style="display:flex; flex-direction:column; gap:5px;">
            <label>Th√°ng b√°o c√°o:</label>
            <input type="month" id="thangBaoCao" class="form-control" required>
        </div>
    </div>

    <!-- MODULE A - MU·ªêI I-·ªêT -->
    <div class="card">
        <div class="card-title">üöÄ MODULE A: T·ª∑ L·ªá H·ªô S·ª≠ D·ª•ng Mu·ªëi I-·ªët</div>
        <div class="grid-khom" id="khomGrid">
            <!-- JS s·∫Ω render 16 kh√≥m ·ªü ƒë√¢y -->
        </div>
        <div style="margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
            <div>T·ªïng s·ªë h·ªô: <span id="tongSoHo" class="total-badge">0</span></div>
            <div>T·ª∑ l·ªá s·ª≠ d·ª•ng: <span id="tyLePhanTram" class="total-badge">0%</span></div>
        </div>
    </div>

    <!-- MODULE A (TI·∫æP) - V√ÉNG GIA -->
    <div class="card">
        <div class="card-title">üì¢ Module A: Truy·ªÅn Th√¥ng Mu·ªëi I-·ªët</div>
        <div class="table-responsive">
            <table id="tableVangGia">
                <thead>
                    <tr>
                        <th>Lo·∫°i h√¨nh</th>
                        <th>S·ªë l·∫ßn</th>
                        <th>Th·ªùi l∆∞·ª£ng (ph√∫t)</th>
                        <th>N·ªôi dung</th>
                        <th>Ng∆∞·ªùi tham gia</th>
                    </tr>
                </thead>
                <tbody id="bodyA2">
                    <tr>
                        <td><b>Ph√°t thanh</b></td>
                        <td><input type="number" class="form-control" data-key="times"></td>
                        <td><input type="number" class="form-control" data-key="duration"></td>
                        <td><input type="text" class="form-control" value="Tuy√™n truy·ªÅn s·ª≠ d·ª•ng mu·ªëi I-·ªët ph√≤ng b·ªánh b∆∞·ªõu c·ªï"></td>
                        <td><input type="number" class="form-control" data-key="people"></td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-add" onclick="addRow('bodyA2', 5)">+ Th√™m d√≤ng truy·ªÅn th√¥ng tr·ª±c ti·∫øp</button>
        </div>
    </div>

    <!-- MODULE B - COPD & HEN -->
    <div class="card">
        <div class="card-title">ü´Å MODULE B: COPD & HEN</div>
        <table>
            <thead>
                <tr>
                    <th>H√¨nh th·ª©c</th>
                    <th>S·ªë l·∫ßn</th>
                    <th>N·ªôi dung</th>
                    <th>Ng∆∞·ªùi tham gia</th>
                </tr>
            </thead>
            <tbody id="bodyB">
                <tr>
                    <td><b>Ph√°t loa</b></td>
                    <td><input type="number" class="form-control"></td>
                    <td><input type="text" class="form-control"></td>
                    <td><input type="number" class="form-control"></td>
                </tr>
                <tr>
                    <td><b>Tr·ª±c ti·∫øp</b></td>
                    <td><input type="number" class="form-control"></td>
                    <td><input type="text" class="form-control"></td>
                    <td><input type="number" class="form-control"></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- MODULE C - KH√ÅM S√ÄNG L·ªåC -->
    <div class="card">
        <div class="card-title">ü©∫ MODULE C: Kh√°m S√†ng L·ªçc</div>
        <table id="tableModuleC">
            <thead>
                <tr>
                    <th>Ch·ªâ ti√™u</th>
                    <th>Nh√† M√°t</th>
                    <th>Hi·ªáp Th√†nh</th>
                    <th>Vƒ©nh Tr·∫°ch ƒê√¥ng</th>
                    <th>T·ªïng</th>
                </tr>
            </thead>
            <tbody>
                <tr data-row="HTA">
                    <td><b>TƒÉng huy·∫øt √°p</b></td>
                    <td><input type="number" class="form-control calc-c" data-col="1"></td>
                    <td><input type="number" class="form-control calc-c" data-col="2"></td>
                    <td><input type="number" class="form-control calc-c" data-col="3"></td>
                    <td class="res-c">0</td>
                </tr>
                <tr data-row="DTƒê">
                    <td><b>ƒê√°i th√°o ƒë∆∞·ªùng</b></td>
                    <td><input type="number" class="form-control calc-c" data-col="1"></td>
                    <td><input type="number" class="form-control calc-c" data-col="2"></td>
                    <td><input type="number" class="form-control calc-c" data-col="3"></td>
                    <td class="res-c">0</td>
                </tr>
                <tr data-row="COPD">
                    <td><b>COPD</b></td>
                    <td><input type="number" class="form-control calc-c" data-col="1"></td>
                    <td><input type="number" class="form-control calc-c" data-col="2"></td>
                    <td><input type="number" class="form-control calc-c" data-col="3"></td>
                    <td class="res-c">0</td>
                </tr>
                <tr data-row="HEN">
                    <td><b>Hen</b></td>
                    <td><input type="number" class="form-control calc-c" data-col="1"></td>
                    <td><input type="number" class="form-control calc-c" data-col="2"></td>
                    <td><input type="number" class="form-control calc-c" data-col="3"></td>
                    <td class="res-c">0</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- MODULE D - TRUY·ªÄN TH√îNG NCD -->
    <div class="card">
        <div class="card-title">üìä MODULE D: Truy·ªÅn Th√¥ng B·ªánh Kh√¥ng L√¢y Nhi·ªÖm</div>
        <table>
            <thead>
                <tr>
                    <th>Lo·∫°i h√¨nh</th>
                    <th>N·ªôi dung</th>
                    <th>S·ªë l∆∞·ª£t</th>
                </tr>
            </thead>
            <tbody id="bodyD">
                <tr>
                    <td><input type="text" class="form-control"></td>
                    <td><input type="text" class="form-control"></td>
                    <td><input type="number" class="form-control"></td>
                </tr>
            </tbody>
        </table>
        <button class="btn btn-add" onclick="addRow('bodyD', 3)">+ Th√™m d√≤ng</button>
    </div>

    <button class="btn btn-save" onclick="saveData()">üíæ L∆ØU B√ÅO C√ÅO G·ª¨I H·ªÜ TH·ªêNG</button>
</div>

<!-- FIREBASE SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, setDoc, collection } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- C·∫§U H√åNH FIREBASE C·ª¶A B·∫†N ---
    const firebaseConfig = {
        apiKey: "AIzaSyCLCcgaoW9gNYhKk0c0gDWC6i5mKVTN4XE",
        authDomain: "profile-d1214.firebaseapp.com",
        projectId: "profile-d1214",
        storageBucket: "profile-d1214.firebasestorage.app",
        messagingSenderId: "914980131889",
        appId: "1:914980131889:web:72f8da15c42dbee671b110"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // D·ªØ li·ªáu danh s√°ch Kh√≥m
    const listKhom = [
        "Bi·ªÉn ƒê√¥ng A", "Bi·ªÉn ƒê√¥ng B", "Bi·ªÉn T√¢y A", "Bi·ªÉn T√¢y B",
        "Gi·ªìng Gi·ªØa A", "Gi·ªìng Gi·ªØa B", "Gi·ªìng Gi·ªØa", "X√≥m L·∫©m",
        "Gi·ªìng Nh√£n", "Gi·ªìng Nh√£n A", "ƒê·∫ßu L·ªô", "ƒê·∫ßu L·ªô A",
        "Ch√≤m Xo√†i", "Nh√† M√°t", "B·ªù T√¢y", "Kinh T·∫ø"
    ];

    // Render Module A1
    const grid = document.getElementById('khomGrid');
    listKhom.forEach(khom => {
        grid.innerHTML += `
            <div class="khom-item">
                <label>${khom}</label>
                <div class="input-group-custom">
                    <input type="number" class="khom-val" data-name="${khom}" max="21" oninput="calcModuleA1()">
                    <span>/21</span>
                </div>
            </div>
        `;
    });

    // T√≠nh to√°n Module A1
    window.calcModuleA1 = function() {
        const inputs = document.querySelectorAll('.khom-val');
        let total = 0;
        inputs.forEach(input => {
            let val = parseInt(input.value) || 0;
            if (val > 21) {
                val = 21;
                input.value = 21;
            }
            total += val;
        });
        document.getElementById('tongSoHo').innerText = total;
        let pt = (total / (listKhom.length * 21)) * 100;
        document.getElementById('tyLePhanTram').innerText = pt.toFixed(1) + '%';
    };

    // Th√™m d√≤ng cho c√°c b·∫£ng
    window.addRow = function(id, cols) {
        const tbody = document.getElementById(id);
        const tr = document.createElement('tr');
        for (let i = 0; i < cols; i++) {
            const td = document.createElement('td');
            td.innerHTML = `<input type="text" class="form-control">`;
            tr.appendChild(td);
        }
        tbody.appendChild(tr);
    };

    // T√≠nh to√°n Module C t·ª± ƒë·ªông
    document.querySelectorAll('.calc-c').forEach(input => {
        input.addEventListener('input', () => {
            const row = input.closest('tr');
            const inputs = row.querySelectorAll('.calc-c');
            let sum = 0;
            inputs.forEach(i => sum += (parseInt(i.value) || 0));
            row.querySelector('.res-c').innerText = sum;
        });
    });

    // H√ÄM L∆ØU D·ªÆ LI·ªÜU
    window.saveData = async function() {
        const donVi = document.getElementById('donVi').value;
        const thang = document.getElementById('thangBaoCao').value;

        if (!donVi || !thang) {
            Swal.fire("L·ªói", "Vui l√≤ng ch·ªçn ƒê∆°n v·ªã v√† Th√°ng b√°o c√°o!", "error");
            return;
        }

        Swal.fire({ title: 'ƒêang l∆∞u...', allowOutsideClick: false, didOpen: () => { Swal.showLoading(); } });

        try {
            const data = {
                thongTinChung: { donVi, thang, thoiGianLuu: new Date().toISOString() },
                moduleA1: {},
                moduleA2: [],
                moduleB: [],
                moduleC: {},
                moduleD: []
            };

            // Thu th·∫≠p Module A1
            document.querySelectorAll('.khom-val').forEach(el => {
                data.moduleA1[el.dataset.name] = el.value;
            });

            // Thu th·∫≠p Module A2
            document.querySelectorAll('#bodyA2 tr').forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                data.moduleA2.push({
                    times: inputs[0].value,
                    duration: inputs[1].value,
                    content: inputs[2].value,
                    people: inputs[3].value
                });
            });

            // Thu th·∫≠p Module B
            document.querySelectorAll('#bodyB tr').forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                data.moduleB.push({ times: inputs[0].value, content: inputs[1].value, people: inputs[2].value });
            });

            // Thu th·∫≠p Module C
            document.querySelectorAll('#tableModuleC tbody tr').forEach(tr => {
                const key = tr.dataset.row;
                const inputs = tr.querySelectorAll('input');
                data.moduleC[key] = { nhaMat: inputs[0].value, hiepThanh: inputs[1].value, vinhTrachDong: inputs[2].value };
            });

            // Thu th·∫≠p Module D
            document.querySelectorAll('#bodyD tr').forEach(tr => {
                const inputs = tr.querySelectorAll('input');
                data.moduleD.push({ type: inputs[0].value, content: inputs[1].value, count: inputs[2].value });
            });

            // L∆∞u v√†o Firebase: Path: BaoCao/{DonVi}_{Thang}
            const docId = `${donVi}_${thang}`;
            await setDoc(doc(db, "BaoCaoYTe", docId), data);

            Swal.fire("Th√†nh c√¥ng!", "D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u tr·ªØ an to√†n tr√™n Firebase!", "success");

        } catch (e) {
            console.error(e);
            Swal.fire("L·ªói", "Kh√¥ng th·ªÉ k·∫øt n·ªëi Firebase: " + e.message, "error");
        }
    }
</script>

</body>
</html>


