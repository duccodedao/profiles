<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google API Data Extractor (Contacts, YT, Drive, Calendar)</title>
    <style>
        :root { --primary: #4285f4; --bg: #f8f9fa; --text: #202124; }
        body { font-family: 'Roboto', Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; }
        
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1 { text-align: center; color: var(--primary); margin-bottom: 10px; }
        .subtitle { text-align: center; color: #5f6368; font-size: 14px; margin-bottom: 30px; }

        /* Login Button */
        .login-area { text-align: center; padding: 40px 0; }
        .btn-google { background: #fff; color: #3c4043; border: 1px solid #dadce0; padding: 12px 24px; font-weight: 500; font-size: 16px; border-radius: 4px; cursor: pointer; display: inline-flex; align-items: center; transition: background .2s; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .btn-google:hover { background: #f7f8f8; box-shadow: 0 1px 3px rgba(0,0,0,0.15); }
        .warning-text { color: #d93025; font-size: 13px; margin-top: 15px; background: #fce8e6; padding: 10px; border-radius: 4px; display: inline-block; }

        /* Dashboard */
        #dashboard { display: none; }
        .user-profile { display: flex; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .avatar { width: 50px; height: 50px; border-radius: 50%; margin-right: 15px; }
        .logout-btn { margin-left: auto; background: #d93025; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; }

        /* API Buttons Grid */
        .api-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .btn-api { padding: 15px; border: none; border-radius: 8px; color: white; cursor: pointer; font-size: 14px; font-weight: bold; transition: transform 0.1s; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; }
        .btn-api:active { transform: scale(0.98); }
        
        .btn-contacts { background: linear-gradient(135deg, #0f9d58, #0b8043); }
        .btn-calendar { background: linear-gradient(135deg, #4285f4, #1967d2); }
        .btn-youtube { background: linear-gradient(135deg, #ff0000, #c20000); }
        .btn-drive { background: linear-gradient(135deg, #f4b400, #f09300); }

        /* Results Area */
        .result-box { background: #282a36; color: #50fa7b; padding: 20px; border-radius: 8px; font-family: 'Consolas', monospace; font-size: 13px; height: 400px; overflow-y: auto; white-space: pre-wrap; border: 2px solid #44475a; }
        .status-bar { margin-bottom: 10px; font-weight: bold; color: #4285f4; }
    </style>
</head>
<body>

<div class="container">
    <h1>Super Data Extractor</h1>
    <p class="subtitle">Demo l·∫•y d·ªØ li·ªáu Danh b·∫°, L·ªãch, YouTube, Drive qua Google API</p>

    <!-- M√†n h√¨nh ƒëƒÉng nh·∫≠p -->
    <div id="login-screen" class="login-area">
        <button class="btn-google" onclick="handleLogin()">
            <svg style="width:18px;height:18px;margin-right:10px" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 10.86-2.13 14.82-5.78l-7.73-6c-2.15 1.45-4.92 2.3-7.09 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
            ƒêƒÉng nh·∫≠p & C·∫•p quy·ªÅn
        </button>
        <br>
        <div class="warning-text">
            ‚ö†Ô∏è L∆∞u √Ω: Google s·∫Ω hi·ªán c·∫£nh b√°o "Unverified App". <br>H√£y b·∫•m <b>Advanced -> Go to ... (unsafe)</b> ƒë·ªÉ ti·∫øp t·ª•c.
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard">
        <div class="user-profile">
            <img id="avatar" class="avatar" src="" alt="User">
            <div>
                <h3 id="username" style="margin:0">User</h3>
                <span id="email" style="font-size:12px; color:#666">...</span>
            </div>
            <button class="logout-btn" onclick="handleLogout()">ƒêƒÉng xu·∫•t</button>
        </div>

        <div class="api-grid">
            <button class="btn-api btn-contacts" onclick="getContacts()">
                üìû DANH B·∫†
                <small style="font-weight:normal; margin-top:5px; opacity:0.8">L·∫•y SƒêT & Email b·∫°n b√®</small>
            </button>
            <button class="btn-api btn-calendar" onclick="getCalendar()">
                üìÖ L·ªäCH TR√åNH
                <small style="font-weight:normal; margin-top:5px; opacity:0.8">L·∫•y s·ª± ki·ªán h·ªçp/bay</small>
            </button>
            <button class="btn-api btn-youtube" onclick="getYoutube()">
                üì∫ YOUTUBE
                <small style="font-weight:normal; margin-top:5px; opacity:0.8">L·∫•y Subscriptions</small>
            </button>
            <button class="btn-api btn-drive" onclick="getDrive()">
                üìÇ DRIVE
                <small style="font-weight:normal; margin-top:5px; opacity:0.8">L·∫•y danh s√°ch file</small>
            </button>
        </div>

        <div class="status-bar" id="status-msg">S·∫µn s√†ng...</div>
        <div class="result-box" id="output">
// D·ªØ li·ªáu JSON s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y...
        </div>
    </div>
</div>

<script type="module">
    // Import th∆∞ vi·ªán t·ª´ CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.17.2/firebase-auth.js";

    // C·∫•u h√¨nh Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyCLCcgaoW9gNYhKk0c0gDWC6i5mKVTN4XE", 
        authDomain: "profile-d1214.firebaseapp.com",
        projectId: "profile-d1214",
        storageBucket: "profile-d1214.firebasestorage.app",
        messagingSenderId: "914980131889",
        appId: "1:914980131889:web:72f8da15c42dbee671b110"
    };

    // Kh·ªüi t·∫°o
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // ====================================================
    // TH√äM 4 QUY·ªÄN (SCOPES) QUAN TR·ªåNG
    // ====================================================
    provider.addScope('https://www.googleapis.com/auth/contacts.readonly');       // 1. Danh b·∫°
    provider.addScope('https://www.googleapis.com/auth/calendar.readonly');       // 2. L·ªãch
    provider.addScope('https://www.googleapis.com/auth/youtube.readonly');        // 3. YouTube
    provider.addScope('https://www.googleapis.com/auth/drive.metadata.readonly'); // 4. Drive

    let accessToken = ""; // Bi·∫øn l∆∞u token

    // X·ª≠ l√Ω UI
    const loginScreen = document.getElementById('login-screen');
    const dashboard = document.getElementById('dashboard');
    const output = document.getElementById('output');
    const statusMsg = document.getElementById('status-msg');

    function log(msg, data = null) {
        statusMsg.textContent = msg;
        if(data) {
            output.textContent = JSON.stringify(data, null, 4); // Format JSON ƒë·∫πp
        } else {
            output.textContent = "// ƒêang ch·ªù d·ªØ li·ªáu...";
        }
    }

    // 1. ƒêƒÉng nh·∫≠p
    window.handleLogin = () => {
        signInWithPopup(auth, provider)
            .then((result) => {
                const credential = GoogleAuthProvider.credentialFromResult(result);
                accessToken = credential.accessToken; // L·∫§Y TOKEN ·ªû ƒê√ÇY
                console.log("Token:", accessToken);
                log("ƒêƒÉng nh·∫≠p th√†nh c√¥ng! H√£y ch·ªçn m·ªôt ch·ª©c nƒÉng ph√≠a tr√™n.");
            }).catch((error) => {
                console.error(error);
                alert("L·ªói: " + error.message);
            });
    };

    // 2. ƒêƒÉng xu·∫•t
    window.handleLogout = () => signOut(auth);

    // 3. Theo d√µi tr·∫°ng th√°i
    onAuthStateChanged(auth, (user) => {
        if (user) {
            loginScreen.style.display = 'none';
            dashboard.style.display = 'block';
            document.getElementById('avatar').src = user.photoURL;
            document.getElementById('username').textContent = user.displayName;
            document.getElementById('email').textContent = user.email;
        } else {
            loginScreen.style.display = 'block';
            dashboard.style.display = 'none';
            accessToken = "";
        }
    });

    // ====================================================
    // C√ÅC H√ÄM G·ªåI API (FETCH DATA)
    // ====================================================

    // API 1: L·∫•y Danh B·∫° (Google People API)
    window.getContacts = async () => {
        if(!accessToken) return alert("Ch∆∞a c√≥ token!");
        log("ƒêang t·∫£i danh b·∫°...");
        
        // Endpoint ƒë·∫∑c bi·ªát c·ªßa People API
        const url = 'https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers&pageSize=10';
        
        try {
            const res = await fetch(url, { headers: { Authorization: `Bearer ${accessToken}` } });
            const data = await res.json();
            log("ƒê√£ t·∫£i xong Danh b·∫° (10 ng∆∞·ªùi ƒë·∫ßu ti√™n):", data);
        } catch (e) { log("L·ªói: " + e); }
    };

    // API 2: L·∫•y L·ªãch (Google Calendar API)
    window.getCalendar = async () => {
        if(!accessToken) return alert("Ch∆∞a c√≥ token!");
        log("ƒêang t·∫£i l·ªãch tr√¨nh...");
        
        // L·∫•y c√°c s·ª± ki·ªán trong l·ªãch ch√≠nh (primary)
        const url = 'https://www.googleapis.com/calendar/v3/calendars/primary/events?maxResults=10&orderBy=startTime&singleEvents=true';
        
        try {
            const res = await fetch(url, { headers: { Authorization: `Bearer ${accessToken}` } });
            const data = await res.json();
            log("ƒê√£ t·∫£i xong L·ªãch tr√¨nh:", data);
        } catch (e) { log("L·ªói: " + e); }
    };

    // API 3: L·∫•y YouTube (YouTube Data API)
    window.getYoutube = async () => {
        if(!accessToken) return alert("Ch∆∞a c√≥ token!");
        log("ƒêang t·∫£i d·ªØ li·ªáu YouTube...");
        
        // L·∫•y danh s√°ch k√™nh ƒë√£ ƒëƒÉng k√Ω (Subscriptions)
        const url = 'https://www.googleapis.com/youtube/v3/subscriptions?part=snippet&mine=true&maxResults=10';
        
        try {
            const res = await fetch(url, { headers: { Authorization: `Bearer ${accessToken}` } });
            const data = await res.json();
            log("ƒê√£ t·∫£i xong danh s√°ch Subscriptions:", data);
        } catch (e) { log("L·ªói: " + e); }
    };

    // API 4: L·∫•y Drive (Google Drive API)
    window.getDrive = async () => {
        if(!accessToken) return alert("Ch∆∞a c√≥ token!");
        log("ƒêang t·∫£i file Drive...");
        
        // L·∫•y 10 file g·∫ßn nh·∫•t
        const url = 'https://www.googleapis.com/drive/v3/files?pageSize=10&fields=files(id,name,mimeType,createdTime)';
        
        try {
            const res = await fetch(url, { headers: { Authorization: `Bearer ${accessToken}` } });
            const data = await res.json();
            log("ƒê√£ t·∫£i xong danh s√°ch File:", data);
        } catch (e) { log("L·ªói: " + e); }
    };

</script>

</body>
</html>
