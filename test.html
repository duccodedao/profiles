<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Privacy & Device Transparency Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-granted { background-color: #10b981; box-shadow: 0 0 8px #10b981; }
        .status-denied { background-color: #ef4444; }
        .status-prompt { background-color: #f59e0b; }
        
        #consent-modal {
            display: flex;
            transition: opacity 0.3s ease-in-out;
        }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen">

    <!-- CONSENT MODAL -->
    <div id="consent-modal" class="fixed inset-0 z-50 items-center justify-center bg-slate-900/80 p-4">
        <div class="glass-card max-w-md w-full p-8 rounded-2xl shadow-2xl">
            <div class="text-blue-600 mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04a11.357 11.357 0 00-1.573 1.831c-.246.47-.472.955-.684 1.442a11.41 11.41 0 001.078 10.901c.411.556.88 1.074 1.407 1.545A11.956 11.956 0 0012 21.056a11.956 11.956 0 007.727-2.351a11.956 11.956 0 001.407-1.545 11.41 11.41 0 001.078-10.901 11.411 11.411 0 00-2.257-3.273z" />
                </svg>
            </div>
            <h2 class="text-2xl font-bold mb-2">Privacy Education Demo</h2>
            <p class="text-slate-600 mb-6 text-sm leading-relaxed">
                This website is a demonstration of what technical information your browser can share with websites. 
                <br><br>
                <strong>No data is stored or tracked.</strong> All information is displayed locally on your screen for educational purposes. Sensitive sensors like your camera or location will only be accessed if you click "Enable" inside the app.
            </p>
            <button id="accept-consent" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition duration-200">
                I Understand & Consent
            </button>
        </div>
    </div>

    <!-- MAIN DASHBOARD -->
    <div class="max-w-6xl mx-auto px-4 py-12">
        <header class="mb-12">
            <h1 class="text-4xl font-extrabold text-slate-900 mb-2 tracking-tight">Environment Transparency Dashboard</h1>
            <p class="text-slate-500">Educational tool for browser fingerprinting and permission awareness.</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            
            <!-- SYSTEM INFO -->
            <div class="glass-card p-6 rounded-xl shadow-sm">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">üíª</span> System & Browser
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Browser:</span>
                        <span id="browser-name" class="font-medium text-right">-</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">OS:</span>
                        <span id="os-name" class="font-medium text-right">-</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Resolution:</span>
                        <span id="screen-res" class="font-medium">-</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Device Type:</span>
                        <span id="device-type" class="font-medium">-</span>
                    </div>
                </div>
            </div>

            <!-- NETWORK INFO -->
            <div class="glass-card p-6 rounded-xl shadow-sm">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">üåê</span> Network & Location (IP)
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Public IP:</span>
                        <span id="public-ip" class="font-medium text-blue-600">Loading...</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Country:</span>
                        <span id="ip-country" class="font-medium">-</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Connection:</span>
                        <span id="net-type" class="font-medium">-</span>
                    </div>
                    <div class="flex justify-between border-b pb-1">
                        <span class="text-slate-500">Timezone:</span>
                        <span id="timezone" class="font-medium">-</span>
                    </div>
                </div>
            </div>

            <!-- PERMISSION STATUS -->
            <div class="glass-card p-6 rounded-xl shadow-sm">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">üõ°Ô∏è</span> Permission Status
                </h3>
                <div class="space-y-3 text-sm">
                    <div class="flex items-center justify-between">
                        <span>Geolocation:</span>
                        <span id="perm-geo" class="flex items-center"><span class="status-dot status-prompt"></span>Prompt</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Camera:</span>
                        <span id="perm-cam" class="flex items-center"><span class="status-dot status-prompt"></span>Prompt</span>
                    </div>
                    <div class="flex items-center justify-between">
                        <span>Microphone:</span>
                        <span id="perm-mic" class="flex items-center"><span class="status-dot status-prompt"></span>Prompt</span>
                    </div>
                </div>
            </div>

            <!-- SENSITIVE ACTIONS -->
            <div class="glass-card p-6 rounded-xl shadow-sm lg:col-span-2">
                <h3 class="font-bold text-lg mb-4 flex items-center">
                    <span class="mr-2">‚ö°</span> On-Demand Access
                </h3>
                <p class="text-xs text-slate-500 mb-4 italic">Note: These only work after you click "Request". Browser will show a popup.</p>
                <div class="flex flex-wrap gap-4">
                    <button onclick="requestGeo()" class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm hover:bg-black transition">Request Geolocation</button>
                    <button onclick="requestMedia('video')" class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm hover:bg-black transition">Test Camera</button>
                    <button onclick="requestMedia('audio')" class="bg-slate-800 text-white px-4 py-2 rounded-lg text-sm hover:bg-black transition">Test Mic</button>
                    <label class="cursor-pointer bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm hover:bg-blue-200 transition">
                        Select File... <input type="file" class="hidden" onchange="handleFile(this)">
                    </label>
                </div>
                <div id="action-output" class="mt-4 p-3 bg-slate-100 rounded border border-dashed border-slate-300 text-sm font-mono min-h-[40px] break-all">
                    Awaiting user action...
                </div>
            </div>

            <!-- CLEAR DATA -->
            <div class="glass-card p-6 rounded-xl shadow-sm border-red-100">
                <h3 class="font-bold text-lg mb-4">Reset Demo</h3>
                <p class="text-xs text-slate-500 mb-4">Wipe all collected session data from the UI display.</p>
                <button onclick="clearData()" class="w-full border border-red-500 text-red-500 hover:bg-red-50 py-2 rounded-lg text-sm transition font-bold">
                    Clear Collected Data
                </button>
            </div>

        </div>

        <footer class="mt-12 text-center text-slate-400 text-sm">
            <p>Built for educational transparency. No data leaves this device.</p>
        </footer>
    </div>

    <script>
        // 1. CONSENT LOGIC
        const modal = document.getElementById('consent-modal');
        const acceptBtn = document.getElementById('accept-consent');

        acceptBtn.addEventListener('click', () => {
            modal.classList.add('hidden');
            initializeDemo();
        });

        // 2. DATA INITIALIZATION
        function initializeDemo() {
            // Browser & OS Detection (Basic)
            const ua = navigator.userAgent;
            const platform = navigator.platform;
            
            document.getElementById('browser-name').innerText = getBrowser(ua);
            document.getElementById('os-name').innerText = getOS(ua);
            document.getElementById('screen-res').innerText = `${window.screen.width} x ${window.screen.height}`;
            document.getElementById('device-type').innerText = /Mobi|Android/i.test(ua) ? 'Mobile Device' : 'Desktop';
            document.getElementById('timezone').innerText = Intl.DateTimeFormat().resolvedOptions().timeZone;
            document.getElementById('net-type').innerText = navigator.connection ? navigator.connection.effectiveType : 'Unknown';

            // Fetch IP & Country (The only external call)
            fetch('https://ipapi.co/json/')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('public-ip').innerText = data.ip;
                    document.getElementById('ip-country').innerText = `${data.country_name} (${data.country_code})`;
                })
                .catch(() => {
                    document.getElementById('public-ip').innerText = "Blocked by AdBlocker/Error";
                });

            updatePermissionStatus();
        }

        // 3. SENSITIVE ACCESS LOGIC
        async function requestGeo() {
            const out = document.getElementById('action-output');
            out.innerText = "Requesting location...";
            
            navigator.geolocation.getCurrentPosition(
                (pos) => {
                    out.innerHTML = `‚úÖ Lat: ${pos.coords.latitude.toFixed(4)}, Lng: ${pos.coords.longitude.toFixed(4)} <br><span class="text-[10px]">(Accuracy: ${pos.coords.accuracy}m)</span>`;
                    updatePermissionStatus();
                },
                (err) => {
                    out.innerText = `‚ùå Denied: ${err.message}`;
                    updatePermissionStatus();
                }
            );
        }

        async function requestMedia(type) {
            const out = document.getElementById('action-output');
            const constraints = type === 'video' ? {video: true} : {audio: true};
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                const track = stream.getTracks()[0];
                out.innerText = `‚úÖ Accessed: ${track.label}`;
                
                // Immediately stop the track to turn off the hardware light
                track.stop();
                updatePermissionStatus();
            } catch (err) {
                out.innerText = `‚ùå Denied: ${err.name}`;
                updatePermissionStatus();
            }
        }

        function handleFile(input) {
            const out = document.getElementById('action-output');
            if (input.files && input.files[0]) {
                const file = input.files[0];
                out.innerText = `üìÑ Manual File Selected: ${file.name} (${(file.size/1024).toFixed(1)} KB)`;
            }
        }

        // 4. UTILS
        function getBrowser(ua) {
            if (ua.includes("Chrome")) return "Google Chrome";
            if (ua.includes("Firefox")) return "Mozilla Firefox";
            if (ua.includes("Safari")) return "Safari";
            return "Unknown Browser";
        }

        function getOS(ua) {
            if (ua.indexOf("Win") != -1) return "Windows";
            if (ua.indexOf("Mac") != -1) return "MacOS";
            if (ua.indexOf("Linux") != -1) return "Linux";
            if (ua.indexOf("Android") != -1) return "Android";
            if (ua.indexOf("like Mac") != -1) return "iOS";
            return "Unknown OS";
        }

        async function updatePermissionStatus() {
            const permissions = ['geolocation', 'camera', 'microphone'];
            const ids = ['perm-geo', 'perm-cam', 'perm-mic'];

            permissions.forEach(async (p, index) => {
                try {
                    const status = await navigator.permissions.query({name: p});
                    renderStatusBadge(ids[index], status.state);
                    status.onchange = () => renderStatusBadge(ids[index], status.state);
                } catch (e) {
                    // Safari doesn't support some permission queries
                    renderStatusBadge(ids[index], 'Supported (Interaction Required)');
                }
            });
        }

        function renderStatusBadge(id, state) {
            const el = document.getElementById(id);
            let dotClass = 'status-prompt';
            if (state === 'granted') dotClass = 'status-granted';
            if (state === 'denied') dotClass = 'status-denied';
            
            el.innerHTML = `<span class="status-dot ${dotClass}"></span>${state.charAt(0).toUpperCase() + state.slice(1)}`;
        }

        function clearData() {
            const fields = ['browser-name', 'os-name', 'screen-res', 'device-type', 'public-ip', 'ip-country', 'net-type', 'timezone'];
            fields.forEach(f => document.getElementById(f).innerText = '-');
            document.getElementById('action-output').innerText = 'Data Cleared. Refresh to restart.';
            alert("Local display data has been cleared.");
        }
    </script>
</body>
</html>
