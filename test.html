<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoRank Clone | Advanced Terminal</title>
    
    <!-- Tailwind CSS & Lucide Icons -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0b0e11; /* Màu chuẩn sàn Binance/CoinGecko */
            color: #eaecef;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1e2329; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #474d57; border-radius: 10px; }

        .coin-table-row:hover { background-color: #1e2329 !important; transition: 0.2s; }
        
        .up-flash { animation: flash-green 0.8s; }
        .down-flash { animation: flash-red 0.8s; }
        @keyframes flash-green { 0% { background: rgba(14, 203, 129, 0.2); } 100% { background: transparent; } }
        @keyframes flash-red { 0% { background: rgba(246, 70, 93, 0.2); } 100% { background: transparent; } }

        .glass { background: rgba(24, 26, 32, 0.8); backdrop-filter: blur(10px); }
        .sticky-header { position: sticky; top: 0; z-index: 50; }
    </style>
</head>
<body class="custom-scrollbar">

    <!-- TOP GLOBAL BAR (Y chang CoinGecko) -->
    <div class="bg-[#181a20] border-b border-gray-800 text-[11px] py-2 px-4 flex gap-6 overflow-x-auto whitespace-nowrap text-gray-400">
        <div>Coins: <span class="text-indigo-400" id="g-coins">0</span></div>
        <div>Exchanges: <span class="text-indigo-400" id="g-exchanges">0</span></div>
        <div>Market Cap: <span class="text-indigo-400" id="g-mcap">0</span></div>
        <div>24h Vol: <span class="text-indigo-400" id="g-vol">0</span></div>
        <div>Dominance: <span class="text-indigo-400">BTC: <span id="g-dom-btc">0</span>% ETH: <span id="g-dom-eth">0</span>%</span></div>
        <div class="flex items-center gap-1"><i data-lucide="zap" class="w-3 h-3 text-yellow-500"></i> ETH Gas: <span class="text-indigo-400" id="g-gas">21 Gwei</span></div>
    </div>

    <!-- MAIN NAV -->
    <nav class="sticky-header glass border-b border-gray-800 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-8">
            <div class="text-2xl font-extrabold tracking-tighter flex items-center gap-2">
                <div class="bg-indigo-600 p-1 rounded-lg"><i data-lucide="bar-chart-3" class="text-white"></i></div>
                CRYPTO<span class="text-indigo-500">RANK</span>
            </div>
            <div class="hidden md:flex gap-6 text-sm font-medium text-gray-400">
                <a href="#" class="hover:text-white transition">Cryptocurrencies</a>
                <a href="#" class="hover:text-white transition">Exchanges</a>
                <a href="#" class="hover:text-white transition">NFT</a>
                <a href="#" class="hover:text-white transition">Portfolio</a>
            </div>
        </div>
        
        <div class="flex items-center gap-4">
            <div class="relative hidden sm:block">
                <i data-lucide="search" class="absolute left-3 top-2.5 w-4 h-4 text-gray-500"></i>
                <input type="text" id="mainSearch" placeholder="Search coins..." class="bg-[#2b2f36] rounded-full py-2 pl-10 pr-4 text-sm focus:outline-none focus:ring-1 focus:ring-indigo-500 w-64">
            </div>
            <button id="loginBtn" onclick="login()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">Login</button>
            <div id="userArea" class="hidden flex items-center gap-3">
                <img id="uPhoto" src="" class="w-8 h-8 rounded-full border border-indigo-500">
                <button onclick="logout()" class="text-gray-400 hover:text-white"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
        </div>
    </nav>

    <main class="max-w-[1400px] mx-auto px-6 py-8">
        
        <!-- HERO / TRENDING CARDS -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
            <div class="bg-[#1e2329] rounded-2xl p-5 border border-gray-800">
                <div class="flex justify-between mb-4">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="trending-up" class="text-green-500"></i> Trending</h3>
                    <a href="#" class="text-indigo-500 text-xs">View more</a>
                </div>
                <div id="trending-list" class="space-y-4 text-sm">
                    <!-- Dynamic trending -->
                </div>
            </div>
            <div class="bg-[#1e2329] rounded-2xl p-5 border border-gray-800">
                <div class="flex justify-between mb-4">
                    <h3 class="font-bold flex items-center gap-2"><i data-lucide="clock" class="text-indigo-500"></i> Recently Added</h3>
                    <a href="#" class="text-indigo-500 text-xs">View more</a>
                </div>
                <div id="recent-list" class="space-y-4 text-sm">
                    <!-- Dynamic recent -->
                </div>
            </div>
            <div class="bg-indigo-600/10 rounded-2xl p-6 border border-indigo-500/30 relative overflow-hidden">
                <h3 class="text-xl font-black mb-2">Nexus Pro Terminal</h3>
                <p class="text-gray-400 text-sm mb-4">Truy cập dữ liệu On-chain real-time và tín hiệu cá voi.</p>
                <button class="bg-indigo-600 text-white px-6 py-2 rounded-xl font-bold text-sm">Upgrade Now</button>
                <i data-lucide="crown" class="absolute -right-4 -bottom-4 w-32 h-32 opacity-10 rotate-12"></i>
            </div>
        </div>

        <!-- CATEGORY TABS -->
        <div class="flex gap-4 mb-6 overflow-x-auto pb-2 text-sm">
            <button class="px-4 py-2 bg-[#2b3139] rounded-lg border border-indigo-500 text-white font-bold whitespace-nowrap">Top Cryptocurrencies</button>
            <button class="px-4 py-2 bg-[#1e2329] rounded-lg text-gray-400 hover:text-white transition whitespace-nowrap">DeFi</button>
            <button class="px-4 py-2 bg-[#1e2329] rounded-lg text-gray-400 hover:text-white transition whitespace-nowrap">Stablecoins</button>
            <button class="px-4 py-2 bg-[#1e2329] rounded-lg text-gray-400 hover:text-white transition whitespace-nowrap">Memes</button>
            <button class="px-4 py-2 bg-[#1e2329] rounded-lg text-gray-400 hover:text-white transition whitespace-nowrap">Layer 1 / Layer 2</button>
        </div>

        <!-- MAIN TABLE -->
        <div class="bg-[#181a20] rounded-3xl border border-gray-800 overflow-hidden shadow-2xl">
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead class="bg-[#1e2329] text-gray-400 font-medium">
                        <tr>
                            <th class="py-4 px-6">#</th>
                            <th class="py-4 px-6">Name</th>
                            <th class="py-4 px-6 text-right">Price</th>
                            <th class="py-4 px-6 text-right">1h %</th>
                            <th class="py-4 px-6 text-right">24h %</th>
                            <th class="py-4 px-6 text-right">7d %</th>
                            <th class="py-4 px-6 text-right hidden lg:table-cell">Market Cap</th>
                            <th class="py-4 px-6 text-right hidden xl:table-cell">Volume(24h)</th>
                            <th class="py-4 px-6 text-center">Last 7 Days</th>
                        </tr>
                    </thead>
                    <tbody id="coin-tbody">
                        <!-- Skeleton Loaders -->
                        <tr class="animate-pulse border-b border-gray-800">
                            <td colspan="9" class="py-8 text-center text-gray-600">Syncing with blockchain nodes...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "AIzaSyCLCcgaoW9gNYhKk0c0gDWC6i5mKVTN4XE",
            authDomain: "profile-d1214.firebaseapp.com",
            projectId: "profile-d1214",
            storageBucket: "profile-d1214.firebasestorage.app",
            messagingSenderId: "914980131889",
            appId: "1:914980131889:web:72f8da15c42dbee671b110"
        };
        firebase.initializeApp(firebaseConfig);
        lucide.createIcons();

        // --- STATE ---
        let coinsData = [];

        // --- AUTH ---
        function login() { firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function logout() { firebase.auth().signOut(); }
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginBtn').classList.add('hidden');
                document.getElementById('userArea').classList.remove('hidden');
                document.getElementById('uPhoto').src = user.photoURL;
            } else {
                document.getElementById('loginBtn').classList.remove('hidden');
                document.getElementById('userArea').classList.add('hidden');
            }
        });

        // --- CORE LOGIC ---
        async function fetchAllData() {
            try {
                // 1. Global Data
                const gRes = await fetch('https://api.coingecko.com/api/v3/global');
                const { data: g } = await gRes.json();
                document.getElementById('g-coins').innerText = g.active_cryptocurrencies.toLocaleString();
                document.getElementById('g-exchanges').innerText = g.markets;
                document.getElementById('g-mcap').innerText = '$' + (g.total_market_cap.usd / 1e12).toFixed(2) + 'T';
                document.getElementById('g-vol').innerText = '$' + (g.total_volume.usd / 1e9).toFixed(2) + 'B';
                document.getElementById('g-dom-btc').innerText = g.market_cap_percentage.btc.toFixed(1);
                document.getElementById('g-dom-eth').innerText = g.market_cap_percentage.eth.toFixed(1);

                // 2. Market Table Data (with Sparkline)
                const mRes = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=50&page=1&sparkline=true&price_change_percentage=1h,24h,7d');
                coinsData = await mRes.json();
                renderTable(coinsData);

                // 3. Trending
                const tRes = await fetch('https://api.coingecko.com/api/v3/search/trending');
                const { coins: trending } = await tRes.json();
                renderTrending(trending);

            } catch (err) { console.error("Rate Limit Coingecko!"); }
        }

        function renderTable(data) {
            const tbody = document.getElementById('coin-tbody');
            tbody.innerHTML = '';

            data.forEach((coin, i) => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-gray-800 coin-table-row group cursor-pointer';
                
                const p1h = coin.price_change_percentage_1h_in_currency || 0;
                const p24h = coin.price_change_percentage_24h_in_currency || 0;
                const p7d = coin.price_change_percentage_7d_in_currency || 0;

                tr.innerHTML = `
                    <td class="py-5 px-6 text-gray-500">${i+1}</td>
                    <td class="py-5 px-6">
                        <div class="flex items-center gap-3">
                            <img src="${coin.image}" class="w-8 h-8 rounded-full">
                            <div>
                                <div class="font-bold text-white">${coin.name}</div>
                                <div class="text-[11px] text-gray-500 uppercase">${coin.symbol}</div>
                            </div>
                        </div>
                    </td>
                    <td class="py-5 px-6 text-right font-bold tracking-tight text-white" id="price-${coin.symbol}">
                        $${coin.current_price.toLocaleString(undefined, {minimumFractionDigits: 2})}
                    </td>
                    <td class="py-5 px-6 text-right font-medium ${p1h >= 0 ? 'text-[#0ecb81]' : 'text-[#f6465d]'}">
                        ${p1h.toFixed(2)}%
                    </td>
                    <td class="py-5 px-6 text-right font-medium ${p24h >= 0 ? 'text-[#0ecb81]' : 'text-[#f6465d]'}">
                        ${p24h.toFixed(2)}%
                    </td>
                    <td class="py-5 px-6 text-right font-medium ${p7d >= 0 ? 'text-[#0ecb81]' : 'text-[#f6465d]'}">
                        ${p7d.toFixed(2)}%
                    </td>
                    <td class="py-5 px-6 text-right text-gray-300 hidden lg:table-cell">$${(coin.market_cap / 1e9).toFixed(2)}B</td>
                    <td class="py-5 px-6 text-right text-gray-300 hidden xl:table-cell">$${(coin.total_volume / 1e9).toFixed(2)}B</td>
                    <td class="py-5 px-6">
                        <canvas id="spark-${coin.id}" class="mx-auto" width="120" height="40"></canvas>
                    </td>
                `;
                tbody.appendChild(tr);
                renderSparkline(`spark-${coin.id}`, coin.sparkline_in_7d.price, p7d >= 0 ? '#0ecb81' : '#f6465d');
            });
        }

        function renderSparkline(id, points, color) {
            const ctx = document.getElementById(id).getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: points.map((_, i) => i),
                    datasets: [{
                        data: points,
                        borderColor: color,
                        borderWidth: 1.5,
                        fill: true,
                        backgroundColor: color + '10',
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: false,
                    plugins: { legend: { display: false }, tooltip: { enabled: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        }

        function renderTrending(coins) {
            const container = document.getElementById('trending-list');
            container.innerHTML = coins.slice(0, 4).map(c => `
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-2">
                        <img src="${c.item.small}" class="w-5 h-5 rounded-full">
                        <span>${c.item.name} <span class="text-gray-500 text-[10px]">${c.item.symbol}</span></span>
                    </div>
                    <span class="text-[#0ecb81] font-bold">#${c.item.market_cap_rank}</span>
                </div>
            `).join('');
        }

        // --- LIVE PRICE WEBSOCKET (BINANCE) ---
        function initLivePrices() {
            const symbols = ['btcusdt', 'ethusdt', 'bnbusdt', 'solusdt', 'adarusdt'];
            const ws = new WebSocket(`wss://stream.binance.com:9443/ws/${symbols.map(s => s + '@ticker').join('/')}`);
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                const symbol = data.s.toLowerCase().replace('usdt', '');
                const priceEl = document.getElementById(`price-${symbol}`);
                
                if (priceEl) {
                    const newPrice = parseFloat(data.c);
                    const oldPrice = parseFloat(priceEl.innerText.replace('$', '').replace(',', ''));
                    
                    priceEl.innerText = `$${newPrice.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
                    
                    // Hiệu ứng flash giá
                    if (newPrice > oldPrice) {
                        priceEl.classList.add('up-flash');
                        setTimeout(() => priceEl.classList.remove('up-flash'), 800);
                    } else if (newPrice < oldPrice) {
                        priceEl.classList.add('down-flash');
                        setTimeout(() => priceEl.classList.remove('down-flash'), 800);
                    }
                }
            };
        }

        // --- INIT ---
        window.onload = () => {
            fetchAllData();
            initLivePrices();
            setInterval(fetchAllData, 60000); // Refresh data mỗi phút
        };
    </script>
</body>
</html>
