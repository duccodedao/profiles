<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>United Stables | Managed by Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fff; color: #202630; }
        .glass-header { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(0,0,0,0.05); border-radius: 100px; }
        .gold-text { background: linear-gradient(90deg, #d3b538, #968129); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .admin-panel { display: none; border: 2px dashed #d3b538; padding: 20px; margin: 20px; border-radius: 20px; background: #fffcf0; }
        #login-btn, #logout-btn { cursor: pointer; }
    </style>
</head>
<body>

    <!-- Admin Panel (Ch·ªâ hi·ªán cho UID c·ª• th·ªÉ) -->
    <div id="admin-section" class="admin-panel sticky top-24 z-[100] shadow-2xl">
        <h3 class="font-bold text-xl mb-4 text-yellow-700">üõ† Admin CMS Dashboard</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-bold">Hero Title</label>
                <input id="edit-title" type="text" class="w-full p-2 border rounded">
            </div>
            <div>
                <label class="block text-sm font-bold">Hero Subtitle</label>
                <input id="edit-subtitle" type="text" class="w-full p-2 border rounded">
            </div>
            <div>
                <label class="block text-sm font-bold">Video URL (Main)</label>
                <input id="edit-video" type="text" class="w-full p-2 border rounded">
            </div>
        </div>
        <button id="save-btn" class="mt-4 bg-yellow-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-yellow-700">C·∫≠p nh·∫≠t n·ªôi dung</button>
    </div>

    <!-- Navigation -->
    <div class="fixed top-0 left-0 right-0 w-full flex justify-center pt-6 px-4 z-50">
        <div class="glass-header w-full max-w-[800px] px-6 py-3 flex items-center justify-between shadow-sm">
            <div class="flex items-center gap-2">
                <img src="https://www.u.tech/images/logo-icon.svg" class="w-6">
                <span class="font-medium">United Stables</span>
            </div>
            <div class="flex items-center gap-4">
                <a href="#home" class="hidden md:block hover:text-yellow-600 transition">Home</a>
                <div id="user-info" class="flex items-center gap-2 border-l pl-4">
                    <button id="login-btn" class="bg-black text-white px-4 py-2 rounded-full text-sm">Login with Google</button>
                    <div id="admin-badge" class="hidden bg-yellow-100 text-yellow-700 text-[10px] px-2 py-1 rounded-full font-bold">ADMIN</div>
                    <button id="logout-btn" class="hidden text-red-500 text-sm font-bold">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Background Video -->
    <div class="absolute top-0 left-0 right-0 w-full z-0 h-[100vh]">
        <video id="display-video" src="https://www.u.tech/images/main-banner-bg.webm" autoPlay loop muted playsInline class="w-full h-full object-cover"></video>
    </div>

    <!-- Hero Section -->
    <section id="home" class="relative z-10 pt-[25vh] pb-24 text-center">
        <h1 class="text-6xl md:text-8xl font-medium tracking-tight mb-4">
            <span id="display-title">Meet <span class="gold-text">$U</span></span>
        </h1>
        <p id="display-subtitle" class="text-xl md:text-2xl text-gray-600 mb-8 px-4">The Most United Stablecoin for Everyone</p>
        <div class="flex justify-center gap-4">
            <button class="bg-[#202630] text-white px-10 py-4 rounded-full font-medium hover:scale-105 transition">Mint $U</button>
        </div>
    </section>

    <!-- Script Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // C·∫•u h√¨nh Firebase c·ªßa b·∫°n
        const firebaseConfig = {
            apiKey: "AIzaSyCLCcgaoW9gNYhKk0c0gDWC6i5mKVTN4XE",
            authDomain: "profile-d1214.firebaseapp.com",
            projectId: "profile-d1214",
            storageBucket: "profile-d1214.firebasestorage.app",
            messagingSenderId: "914980131889",
            appId: "1:914980131889:web:72f8da15c42dbee671b110",
            measurementId: "G-C587M69LZW"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const ADMIN_UID = "VYIs9XHLR9RMStwtcdwMrOIo33w1";

        // DOM Elements
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const adminSection = document.getElementById('admin-section');
        const adminBadge = document.getElementById('admin-badge');
        
        const displayTitle = document.getElementById('display-title');
        const displaySubtitle = document.getElementById('display-subtitle');
        const displayVideo = document.getElementById('display-video');

        const editTitle = document.getElementById('edit-title');
        const editSubtitle = document.getElementById('edit-subtitle');
        const editVideo = document.getElementById('edit-video');
        const saveBtn = document.getElementById('save-btn');

        // 1. ƒêƒÉng nh·∫≠p / ƒêƒÉng xu·∫•t
        loginBtn.onclick = () => signInWithPopup(auth, provider);
        logoutBtn.onclick = () => signOut(auth);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                loginBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                console.log("Logged in UID:", user.uid);
                
                // Ki·ªÉm tra quy·ªÅn Admin
                if (user.uid === ADMIN_UID) {
                    adminSection.style.display = 'block';
                    adminBadge.classList.remove('hidden');
                }
            } else {
                loginBtn.classList.remove('hidden');
                logoutBtn.classList.add('hidden');
                adminSection.style.display = 'none';
                adminBadge.classList.add('hidden');
            }
        });

        // 2. L·∫•y d·ªØ li·ªáu Real-time t·ª´ Firestore
        const docRef = doc(db, "siteContent", "homepage");

        onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                const data = docSnap.data();
                displayTitle.innerHTML = data.title; // D√πng innerHTML ƒë·ªÉ h·ªó tr·ª£ th·∫ª span gold-text
                displaySubtitle.innerText = data.subtitle;
                if(data.videoUrl) displayVideo.src = data.videoUrl;

                // ƒêi·ªÅn s·∫µn v√†o form edit cho admin
                editTitle.value = data.title;
                editSubtitle.value = data.subtitle;
                editVideo.value = data.videoUrl;
            } else {
                console.log("No data found, please create document 'siteContent/homepage'");
            }
        });

        // 3. Admin c·∫≠p nh·∫≠t d·ªØ li·ªáu
        saveBtn.onclick = async () => {
            try {
                await updateDoc(docRef, {
                    title: editTitle.value,
                    subtitle: editSubtitle.value,
                    videoUrl: editVideo.value
                });
                alert("C·∫≠p nh·∫≠t th√†nh c√¥ng!");
            } catch (error) {
                console.error("Error updating:", error);
                alert("B·∫°n kh√¥ng c√≥ quy·ªÅn ho·∫∑c l·ªói k·∫øt n·ªëi!");
            }
        };
    </script>
</body>
</html>
