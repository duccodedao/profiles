B·∫°n bi·∫øt d·ª± √°n unich kh√¥ng, T√¥i mu·ªën th√™m 1 ph·∫ßn d·ª± √°n ƒë√≥ v√†o site c·ªßa t√¥i v·ªõi giao di·ªán si√™u ƒë·∫πp hi·ªán ƒë·∫°i chuy√™n nghi·ªáp, trong ph·∫ßn site s·∫Ω code d·ª± √°n Unich ri√™ng bi·ªát, c√≥ ti√™u ƒë·ªÅ, m√¥ t·∫£ d·ª± √°n, link t·∫£i apple store, ch play (c√≥ logo apple v√† ch play), m√£ qr (admin t·∫£i m√£ qr l√™n), link ref, code ref (c√≥ th·ªÉ sao ch√©p), ph·∫ßn unich c√≥ logo bi·ªÉu t∆∞·ªüng , T√¥i mu·ªën code tr·ª±c ti·∫øp d√¥ site lu√¥n, nh∆∞ 1 ph·∫ßn c·ªßa site, xo√° ph·∫ßn th√¥ng tin c√° nh√¢n (gi·ªõi t√≠nh, ng√†y sinh, t·ªânh) , ƒê·ªìng b·ªô ho√° giao di·ªán, ho√† tan Unich v·ªõi source
, fix logo ng√¢n h√†ng, fix b·ªë c·ª•c nh√† m·∫°ng, s·ªë ƒëi·ªán tho·∫°i
Ri√™ng ƒë·ªëi v·ªõi ph·∫ßn unich, admin c√≥ th·ªÉ setup ƒë·ªãnh v·ªã c·ªßa admin v√† l∆∞u tr·ªØ l·∫°i, admin b·∫•m update v·ªã tr√≠ th√¨ l·∫•y v·ªã tr√≠ m·ªõi, b√™n user s·∫Ω c≈©ng c√≥ ph·∫ßn ƒë·ªãnh v·ªã, n·∫øu v·ªã tr√≠ c·ªßa user v√† admin ph·∫°m vi 10km th√¨ ƒë∆∞a ra t√≠n hi·ªáu ƒë·ªÉ 2 ng k·∫øt n·ªëi v·ªõi nhau, admin c√≥ th·ªÉ t·∫Øt v·ªã tr√≠ ngay tr√™n c·∫•u h√¨nh tr√°nh l·ªô th√¥ng tin ri√™ng t∆∞, s·∫µn fix l∆∞·ª£t xem site

t√¥i mu·ªën code th√™m ph·∫ßn unich ƒë√≥ th√†nh 1 tab ri√™ng, n∆°i m√† ai c≈©ng c√≥ th·ªÉ tham gia, h·ªç s·∫Ω c·∫≠p nh·∫≠t v√≠ tr√≠ c·ªßa ch√≠nh m√¨nh, v√† ƒëo kho·∫£ng c√°ch v·ªõi nhau, s·∫Ω s·∫Øp x·∫øp t·ª´ b·∫£n th√¢n ƒë·∫øn admin, v√† t·ª´ b·∫£n th√¢n ƒë·∫øn v·ªõi t·ª´ ng∆∞·ªùi g·∫ßn nh·∫•t ƒë·∫øn ng∆∞·ªùi xa nh·∫•t, khi c·∫≠p nh·∫≠t v·ªã tr·ªã y√™u c·∫ßu ng∆∞·ªùi d√πng cung c·∫•p th√¥ng tin li√™n l·∫°c ƒë·ªÉ h·ªç c√≥ th·ªÉ k·∫øt n·ªëi v·ªõi nhau, c√≥ th·ªÉ b·∫•m g·ªçi, ch·ªâ ƒë∆∞·ªùng
(n·∫øu thi·∫øt b·ªã ios th√¨ apple map, adr th√¨ gg maps), ng∆∞·ªùi d√πng c√≥ th·ªÉ b·∫•m qu√©t b·∫•t k√¨ l√∫c n√†o ƒë·ªÉ l·∫•y v·ªã tr√≠ ch√≠nh x√°c nh·∫•t,
V√† d∆∞·ªõi ƒë√¢y l√† code g·ªëc, CODE L·∫†I T·∫§T C·∫¢ KH√îNG THI·∫æU B·∫§T K√å LOGIC N√ÄO
ƒê·ª´ng ƒë·ªÉ t√¨nh tr·∫°ng n√†y s·∫£y ra
Code m·∫•t t√πm lum logic c≈© üò° code c≈© c·ªßa t√¥i h∆°n 1300 d√≤ng code, sau khi b·ªõt m·∫•y d√≤ng (th√¥ng tin c√° nh√¢n) v√† th√™m nhi·ªÅu t√≠nh nƒÉng th√¨ ch·ªâ c√≥ 1000 d√≤ng code, h·ªèi nh·ªØng d√≤ng code c√≤n l·∫°i ƒëi ƒë√¢u, code ƒë·ªß cho t√¥i

<!DOCTYPE html>
<html lang="vi" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
code
Code

download

content_copy

expand_less
<!-- ================================================================================== -->
<!-- === KHU V·ª∞C C·∫§U H√åNH SEO (THAY ƒê·ªîI N·ªòI DUNG T·∫†I ƒê√ÇY) === -->
<!-- ================================================================================== -->

<!-- 1. TI√äU ƒê·ªÄ TRANG (Hi·ªÉn th·ªã tr√™n tab tr√¨nh duy·ªát) -->
<title>Bmass</title>

<!-- 2. M√î T·∫¢ (Hi·ªÉn th·ªã d∆∞·ªõi ti√™u ƒë·ªÅ khi t√¨m ki·∫øm Google) -->
<meta name="description" id="meta-desc" content="Ch√†o m·ª´ng ƒë·∫øn v·ªõi trang c√° nh√¢n. N∆°i c·∫≠p nh·∫≠t th√¥ng tin, c√¥ng vi·ªác v√† k·∫øt n·ªëi m·∫°ng x√£ h·ªôi nhanh ch√≥ng.">

<!-- 3. LOGO ICON (Favicon - Icon nh·ªè tr√™n tab) -->
<link rel="icon" id="meta-icon" href="https://hdd.io.vn/img/bmassloadings.png" type="image/png">

<!-- 4. OPEN GRAPH (C·∫•u h√¨nh hi·ªÉn th·ªã khi g·ª≠i link qua Zalo/Facebook) -->
<meta property="og:type" content="website">
<meta property="og:title" content="Profile C√° Nh√¢n | K·∫øt N·ªëi & Chia S·∫ª">
<meta property="og:description" content="Click ƒë·ªÉ xem th√¥ng tin chi ti·∫øt, s·ªë ƒëi·ªán tho·∫°i v√† c√°c li√™n k·∫øt m·∫°ng x√£ h·ªôi c·ªßa t√¥i.">
<meta property="og:image" content="https://hdd.io.vn/img/bmasslogos.png"> <!-- Link ·∫£nh ƒë·∫°i di·ªán khi share link -->

<!-- 5. M√ÄU S·∫ÆC TR√åNH DUY·ªÜT (Mobile) -->
<meta name="theme-color" content="#6366f1">

<!-- ================================================================================== -->
<!-- === K·∫æT TH√öC KHU V·ª∞C SEO === -->
<!-- ================================================================================== -->

<!-- PWA / Mobile Capable -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<!-- Link Manifest ƒë·ªông -->
<link rel="manifest" id="dynamic-manifest">

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
<!-- Cropper.js -->
<link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<script>
    tailwind.config = {
        darkMode: 'class',
        theme: { 
            extend: { 
                colors: { 
                    primary: '#6366f1', 
                    secondary: '#ec4899',
                    dark: '#0f172a',
                },
                animation: {
                    'blob': 'blob 7s infinite',
                    'bounce-slow': 'bounce 2s infinite',
                },
                keyframes: {
                    blob: {
                        '0%': { transform: 'translate(0px, 0px) scale(1)' },
                        '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                        '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                        '100%': { transform: 'translate(0px, 0px) scale(1)' }
                    }
                }
            } 
        }
    }
</script>
<style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; transition: background 0.3s; } 
    .dark body { background-color: #020617; color: #e2e8f0; }
    
    /* --- C·∫§U H√åNH N·ªÄN (BACKGROUND) --- */
    /* N·∫øu mu·ªën d√πng ·∫£nh n·ªÅn thay v√¨ m√†u, h√£y b·ªè comment d√≤ng background-image b√™n d∆∞·ªõi v√† thay link ·∫£nh */
    .custom-bg {
        /* background-image: url('https://link-anh-nen-cua-ban.com/bg.jpg'); */
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
    }
    
    .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
    .dark .glass { background: rgba(15, 23, 42, 0.7); border: 1px solid rgba(255,255,255,0.05); }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    .dark ::-webkit-scrollbar-thumb { background: #334155; }

    /* Carrier Branding Colors */
    .carrier-viettel { background: #008445; color: white; }
    .carrier-vinaphone { background: #00aeef; color: white; }
    .carrier-mobifone { background: #005baa; color: white; }
    .carrier-vietnamobile { background: #ff6a00; color: white; }
    .carrier-gmobile { background: #ffcc00; color: black; }
    .carrier-itel { background: #ed1c24; color: white; }

    /* Scroll Reveal Effect */
    .reveal-on-scroll {
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.8s cubic-bezier(0.5, 0, 0, 1);
    }
    .reveal-on-scroll.active {
        opacity: 1;
        transform: translateY(0);
    }
</style>
</head>
<body class="min-h-screen relative overflow-x-hidden pb-10 custom-bg">
code
Code

download

content_copy

expand_less
<!-- Background Elements (Hi·ªáu ·ª©ng Blob) - N·∫øu d√πng ·∫£nh n·ªÅn ·ªü tr√™n th√¨ c√≥ th·ªÉ x√≥a ƒëo·∫°n n√†y -->
<div class="fixed inset-0 z-[-1] overflow-hidden pointer-events-none">
    <div class="absolute top-0 left-1/4 w-96 h-96 bg-primary/20 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob"></div>
    <div class="absolute top-0 right-1/4 w-96 h-96 bg-secondary/20 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-2000"></div>
    <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-purple-500/20 rounded-full mix-blend-multiply filter blur-3xl opacity-70 animate-blob animation-delay-4000"></div>
</div>

<!-- Loading Overlay -->
<div id="global-loading" class="fixed inset-0 bg-white dark:bg-slate-950 z-[900] flex flex-col items-center justify-center transition-opacity duration-300">
    <img src="/img/bmassloadings.png" class="w-20 h-20 mb-4 animate-bounce-slow drop-shadow-2xl">
    <span class="text-sm font-bold text-slate-500 tracking-widest uppercase">ƒêang t·∫£i d·ªØ li·ªáu...</span>
</div>

<!-- USB File Input (Hidden) -->
<input type="file" id="usb-key-input" class="hidden" accept=".json,.txt">

<!-- Navbar -->
<nav class="sticky top-0 z-50 glass px-6 py-3 flex justify-between items-center mb-8">
    <div class="flex items-center gap-3">
        <img id="nav-avatar" src="https://ui-avatars.com/api/?name=P" class="w-9 h-9 rounded-full object-cover border-2 border-primary/20 shadow-sm">
        <span id="nav-nickname" class="font-bold text-lg hidden sm:block tracking-tight truncate max-w-[150px]">MyProfile</span>
    </div>
    <div class="flex items-center gap-2">
        <button onclick="window.toggleTheme()" class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition">
            <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
            <i data-lucide="moon" class="w-5 h-5 dark:hidden"></i>
        </button>
        <button onclick="document.getElementById('usb-key-input').click()" class="p-2 rounded-full text-slate-400 hover:text-primary hover:bg-black/5 dark:hover:bg-white/10 transition" title="K·∫øt n·ªëi USB Key">
            <i data-lucide="usb" class="w-5 h-5"></i>
        </button>
        <button id="admin-btn" onclick="window.openEditModal()" class="hidden px-3 py-1.5 bg-slate-800 dark:bg-white text-white dark:text-slate-900 rounded-lg text-xs font-bold uppercase shadow hover:opacity-90 transition gap-2 items-center">
            <i data-lucide="edit-3" class="w-3 h-3"></i> S·ª≠a
        </button>
         <button id="manager-btn" onclick="window.openManagerModal()" class="hidden p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition" title="Qu·∫£n l√Ω ng∆∞·ªùi d√πng">
            <i data-lucide="users" class="w-5 h-5"></i>
        </button>
        <div id="auth-section"></div>
    </div>
</nav>

<!-- Main Content -->
<main class="max-w-4xl mx-auto px-4 space-y-6">

    <!-- Header Card -->
    <div class="glass rounded-3xl p-6 sm:p-8 flex flex-col md:flex-row items-center md:items-start gap-6 relative overflow-hidden reveal-on-scroll">
        <div class="relative group">
            <div class="absolute -inset-1 bg-gradient-to-r from-primary to-secondary rounded-full blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200"></div>
            <img id="profile-avatar" src="https://ui-avatars.com/api/?name=User&size=256" class="relative w-32 h-32 sm:w-40 sm:h-40 rounded-full object-cover border-4 border-white dark:border-slate-800 shadow-xl">
            <div id="online-indicator" class="absolute bottom-2 right-2 w-5 h-5 bg-green-500 border-4 border-white dark:border-slate-800 rounded-full"></div>
        </div>

        <div class="flex-1 text-center md:text-left space-y-2 z-10">
            <div class="flex flex-col md:flex-row items-center gap-2 md:gap-4 justify-center md:justify-start">
                <h1 id="profile-name" class="text-3xl sm:text-4xl font-black tracking-tight text-slate-800 dark:text-white">Loading...</h1>
                <span id="profile-nickname-badge" class="px-3 py-1 rounded-full bg-primary/10 text-primary text-xs font-bold uppercase tracking-wider hidden"></span>
            </div>
            
            <p id="profile-bio" class="text-slate-500 dark:text-slate-400 font-medium max-w-lg mx-auto md:mx-0">...</p>

            <div class="flex flex-wrap items-center justify-center md:justify-start gap-4 py-3">
                <div class="flex items-center gap-1.5 text-sm font-bold text-slate-700 dark:text-slate-300">
                    <i data-lucide="users" class="w-4 h-4 text-primary"></i>
                    <span id="stat-followers">0</span> <span class="text-slate-400 font-normal">Ng∆∞·ªùi theo d√µi</span>
                </div>
                <div class="flex items-center gap-1.5 text-sm font-bold text-slate-700 dark:text-slate-300">
                    <i data-lucide="eye" class="w-4 h-4 text-secondary"></i>
                    <span id="stat-views">0</span> <span class="text-slate-400 font-normal">L∆∞·ª£t xem</span>
                </div>
                <div id="relationship-display" class="hidden flex items-center gap-1.5 text-sm font-bold text-pink-500 bg-pink-500/10 px-3 py-1 rounded-full">
                    <i data-lucide="heart" class="w-3 h-3 fill-current"></i>
                    <span id="rel-status">ƒê·ªôc th√¢n</span>
                </div>
            </div>

            <div class="flex flex-wrap justify-center md:justify-start gap-3 mt-2">
                <button id="follow-btn" onclick="window.toggleFollow()" class="px-6 py-2.5 bg-slate-900 dark:bg-white text-white dark:text-slate-900 rounded-xl font-bold text-sm shadow-lg hover:transform hover:scale-105 transition flex items-center gap-2">
                    <i data-lucide="user-plus" class="w-4 h-4"></i> Theo d√µi
                </button>
                <button onclick="window.showContactModal('phone')" class="p-2.5 bg-white dark:bg-slate-800 border dark:border-white/10 rounded-xl text-slate-600 dark:text-slate-300 hover:text-primary hover:border-primary transition shadow-sm">
                    <i data-lucide="phone" class="w-5 h-5"></i>
                </button>
                <button onclick="window.showContactModal('email')" class="p-2.5 bg-white dark:bg-slate-800 border dark:border-white/10 rounded-xl text-slate-600 dark:text-slate-300 hover:text-secondary hover:border-secondary transition shadow-sm">
                    <i data-lucide="mail" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Social Links Grid -->
    <div id="social-grid" class="flex flex-wrap justify-center gap-4 reveal-on-scroll"></div>

    <!-- Details Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 reveal-on-scroll">
        <!-- About -->
        <div class="glass p-6 rounded-3xl space-y-4">
            <h3 class="font-black uppercase text-sm tracking-widest text-slate-400 flex items-center gap-2">
                <i data-lucide="info" class="w-4 h-4"></i> Th√¥ng tin c√° nh√¢n
            </h3>
            <ul class="space-y-3">
                <li class="flex items-center justify-between p-3 bg-white/50 dark:bg-slate-800/50 rounded-xl">
                    <span class="text-sm font-medium text-slate-500">Ng√†y sinh</span>
                    <span id="info-dob" class="text-sm font-bold">--/--/----</span>
                </li>
                <li class="flex items-center justify-between p-3 bg-white/50 dark:bg-slate-800/50 rounded-xl">
                    <span class="text-sm font-medium text-slate-500">Gi·ªõi t√≠nh</span>
                    <span id="info-gender" class="text-sm font-bold">---</span>
                </li>
                <li class="flex items-center justify-between p-3 bg-white/50 dark:bg-slate-800/50 rounded-xl">
                    <span class="text-sm font-medium text-slate-500">Qu√™ qu√°n</span>
                    <span id="info-hometown" class="text-sm font-bold text-right max-w-[200px] truncate">---</span>
                </li>
            </ul>
        </div>

        <!-- Banking -->
        <div class="glass p-6 rounded-3xl space-y-4">
            <h3 class="font-black uppercase text-sm tracking-widest text-slate-400 flex items-center gap-2">
                <i data-lucide="credit-card" class="w-4 h-4"></i> Ng√¢n h√†ng
            </h3>
            <div id="bank-list" class="space-y-3 max-h-[200px] overflow-y-auto pr-1"></div>
        </div>
    </div>

    <!-- Timeline -->
    <div class="glass p-6 sm:p-8 rounded-3xl reveal-on-scroll">
        <h3 class="font-black uppercase text-sm tracking-widest text-slate-400 mb-6 flex items-center gap-2">
            <i data-lucide="briefcase" class="w-4 h-4"></i> H·ªçc v·∫•n & C√¥ng vi·ªác
        </h3>
        <div id="career-timeline" class="space-y-6 border-l-2 border-slate-200 dark:border-slate-700 ml-3 pl-6 relative"></div>
    </div>

    <!-- Achievements -->
    <div class="glass p-6 sm:p-8 rounded-3xl reveal-on-scroll">
        <h3 class="font-black uppercase text-sm tracking-widest text-slate-400 mb-6 flex items-center gap-2">
            <i data-lucide="award" class="w-4 h-4"></i> Th√†nh t·ª±u n·ªïi b·∫≠t
        </h3>
        <div id="achievement-list" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
    </div>

    <!-- Partners Section -->
    <div id="partners-section" class="glass p-6 sm:p-8 rounded-3xl hidden reveal-on-scroll">
        <h3 class="font-black uppercase text-sm tracking-widest text-slate-400 mb-6 flex items-center gap-2">
            <i data-lucide="handshake" class="w-4 h-4"></i> ƒê·ªëi t√°c
        </h3>
        <div id="partners-grid" class="flex flex-wrap items-center justify-center gap-8 opacity-70 grayscale hover:grayscale-0 transition-all duration-500"></div>
    </div>

    <!-- Send Message Button (Bottom) -->
    <div class="flex justify-center mt-8 reveal-on-scroll">
        <button onclick="window.showContactForm()" class="w-full max-w-md px-6 py-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-2xl font-bold text-lg shadow-xl hover:shadow-2xl hover:-translate-y-1 transition flex items-center justify-center gap-3">
            <i data-lucide="send" class="w-6 h-6"></i> G·ª≠i tin nh·∫Øn cho t√¥i
        </button>
    </div>

    <!-- IP & Geo Info -->
    <div class="glass mt-8 p-4 rounded-2xl text-center space-y-2 reveal-on-scroll">
        <div class="flex items-center justify-center gap-2 text-xs font-bold text-slate-500 uppercase tracking-widest">
            <i data-lucide="globe" class="w-3 h-3"></i> Th√¥ng tin k·∫øt n·ªëi c·ªßa b·∫°n
        </div>
        <div class="grid grid-cols-2 gap-4 text-sm">
            <div>
                <span class="block text-slate-400 text-xs">ƒê·ªãa ch·ªâ IP</span>
                <span id="user-ip" class="font-mono font-bold text-slate-700 dark:text-white">ƒêang t·∫£i...</span>
            </div>
            <div>
                <span class="block text-slate-400 text-xs">T·ªça ƒë·ªô</span>
                <span id="user-coords" class="font-mono font-bold text-slate-700 dark:text-white">...</span>
            </div>
        </div>
    </div>

</main>

<!-- Footer -->
<footer class="text-center py-8 text-slate-400 text-xs font-medium">
    <p>&copy; 2024 Profile System.</p>
</footer>

<!-- MODALS -->

<!-- Contact View Modal -->
<div id="modal-contact" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-sm p-6 shadow-2xl animate-fade-in">
        <div class="flex justify-between items-center mb-4">
            <h3 id="contact-title" class="font-bold text-lg">Li√™n h·ªá</h3>
            <button onclick="window.closeModal('modal-contact')" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div id="contact-list" class="space-y-3"></div>
    </div>
</div>

<!-- Contact Send Form Modal -->
<div id="modal-send-msg" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md p-6 shadow-2xl animate-fade-in relative">
        <button onclick="window.closeModal('modal-send-msg')" class="absolute top-4 right-4 p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
        <h3 class="font-bold text-lg mb-4">G·ª≠i tin nh·∫Øn</h3>
        <form id="contact-form" class="space-y-4">
            <div>
                <label class="lbl">H·ªç t√™n</label>
                <input type="text" id="msg-name" class="inp" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n...">
            </div>
            <div id="msg-email-group">
                <label class="lbl">Email</label>
                <input type="email" id="msg-email" class="inp" placeholder="email@example.com">
            </div>
            <div>
                <label class="lbl">N·ªôi dung</label>
                <textarea id="msg-content" rows="4" class="inp" placeholder="B·∫°n mu·ªën nh·∫Øn g√¨..."></textarea>
            </div>
            <div class="flex items-center gap-2">
                <input type="checkbox" id="msg-anon" onchange="toggleAnon()" class="w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary">
                <label for="msg-anon" class="text-sm font-medium text-slate-600 dark:text-slate-300">G·ª≠i ·∫©n danh</label>
            </div>
            <button type="button" onclick="window.sendContact()" class="w-full py-2 bg-primary text-white font-bold rounded-xl shadow hover:bg-indigo-600 transition">G·ª≠i ƒëi</button>
        </form>
    </div>
</div>

<!-- Crop Image Modal -->
<div id="modal-crop" class="fixed inset-0 bg-black z-[500] hidden flex flex-col">
    <div class="flex-1 bg-black relative flex items-center justify-center overflow-hidden">
         <img id="image-to-crop" src="" class="max-w-full max-h-full block">
    </div>
    <div class="bg-slate-900 p-4 flex justify-between items-center text-white">
        <button onclick="window.closeModal('modal-crop')" class="px-4 py-2 font-bold text-slate-400">H·ªßy</button>
        <div class="text-sm font-medium">C·∫Øt ·∫£nh ƒë·∫°i di·ªán (Vu√¥ng)</div>
        <button onclick="window.confirmCrop()" class="px-6 py-2 bg-primary rounded-lg font-bold">X√°c nh·∫≠n</button>
    </div>
</div>

<!-- Manager Modal -->
<div id="modal-manager" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-[200] hidden flex items-center justify-center p-4">
    <div class="bg-white dark:bg-slate-900 rounded-2xl w-full max-w-md p-6 shadow-2xl h-[80vh] flex flex-col">
        <div class="flex justify-between items-center mb-4 border-b dark:border-white/10 pb-4">
            <h3 class="font-bold text-lg">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</h3>
            <button onclick="window.closeModal('modal-manager')" class="p-2 hover:bg-slate-100 dark:hover:bg-slate-800 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto space-y-4" id="manager-list"></div>
    </div>
</div>

<!-- Admin Edit Modal -->
<div id="modal-admin" class="fixed inset-0 bg-black/80 backdrop-blur-md z-[300] hidden flex items-center justify-center p-0 sm:p-4">
    <div class="bg-white dark:bg-slate-900 w-full h-full sm:h-[90vh] sm:rounded-2xl sm:max-w-4xl shadow-2xl flex flex-col overflow-hidden">
        <!-- Header -->
        <div class="p-4 border-b dark:border-white/10 flex justify-between items-center bg-slate-50 dark:bg-slate-950">
            <h3 class="font-black uppercase text-primary tracking-widest">Ch·ªânh s·ª≠a Profile</h3>
            <button onclick="window.closeModal('modal-admin')" class="p-2 bg-slate-200 dark:bg-slate-800 rounded-lg"><i data-lucide="x" class="w-5 h-5"></i></button>
        </div>
        
        <!-- Body -->
        <div class="flex-1 flex flex-col sm:flex-row overflow-hidden">
            <div class="w-full sm:w-48 bg-slate-50 dark:bg-slate-950 border-r dark:border-white/5 p-2 flex sm:flex-col gap-2 overflow-x-auto sm:overflow-visible shrink-0">
                <button onclick="window.switchTab('general')" class="tab-btn active p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5">Chung</button>
                <button onclick="window.switchTab('contact')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5">Li√™n h·ªá & MXH</button>
                <button onclick="window.switchTab('career')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5">H·ªçc v·∫•n & Vi·ªác</button>
                <button onclick="window.switchTab('bank')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5">Ng√¢n h√†ng</button>
                <button onclick="window.switchTab('partners')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5">ƒê·ªëi t√°c</button>
                <button onclick="window.switchTab('website')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5 text-purple-500">Website</button>
                <button onclick="window.switchTab('messages')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5 text-green-500">Tin nh·∫Øn</button>
                <button onclick="window.switchTab('config')" class="tab-btn p-3 rounded-lg text-left text-xs font-bold uppercase hover:bg-white dark:hover:bg-white/5 text-red-500">C·∫•u h√¨nh</button>
            </div>

            <div class="flex-1 overflow-y-auto p-6 bg-white dark:bg-slate-900 relative">
                <form id="admin-form" class="space-y-6 max-w-2xl mx-auto pb-20">
                    <!-- TAB: GENERAL -->
                    <div id="tab-general" class="tab-content space-y-4">
                        <div class="flex gap-4 items-center">
                            <img id="preview-avatar" src="" class="w-20 h-20 rounded-full object-cover border">
                            <label class="flex-1 cursor-pointer">
                                <div class="px-4 py-2 bg-slate-100 dark:bg-slate-800 rounded-lg text-sm font-bold text-center border-dashed border-2 border-slate-300 hover:border-primary">
                                    T·∫£i ·∫£nh m·ªõi (C√≥ c·∫Øt)
                                </div>
                                <input type="file" id="inp-avatar" class="hidden" accept="image/*">
                            </label>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="lbl">H·ªç t√™n</label><input type="text" id="inp-name" class="inp"></div>
                            <div><label class="lbl">Bi·ªát danh</label><input type="text" id="inp-nickname" class="inp"></div>
                        </div>
                        <div><label class="lbl">Ti·ªÉu s·ª≠ (Bio)</label><textarea id="inp-bio" rows="3" class="inp"></textarea></div>
                        <div class="grid grid-cols-2 gap-4">
                            <div><label class="lbl">Ng√†y sinh</label><input type="date" id="inp-dob" class="inp"></div>
                            <div><label class="lbl">Gi·ªõi t√≠nh</label><select id="inp-gender" class="inp"><option>Nam</option><option>N·ªØ</option><option>Kh√°c</option></select></div>
                        </div>
                        
                        <!-- QU√ä QU√ÅN -->
                        <div class="space-y-2 border p-3 rounded-xl dark:border-white/10">
                            <label class="lbl text-primary">Qu√™ qu√°n (Ch·ªçn T·ªânh)</label>
                            <select id="api-city" onchange="updateHometownStr()" class="inp text-sm font-bold">
                                <option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>
                            </select>
                            <input type="hidden" id="inp-hometown-full">
                        </div>

                        <div class="border p-3 rounded-xl dark:border-white/10 space-y-2">
                            <label class="lbl">M·ªëi quan h·ªá</label>
                            <select id="inp-rel-status" class="inp mb-2" onchange="togglePartnerInput()">
                                <option value="ƒê·ªôc th√¢n">ƒê·ªôc th√¢n</option>
                                <option value="ƒêang h·∫πn h√≤">ƒêang h·∫πn h√≤</option>
                                <option value="ƒê√£ k·∫øt h√¥n">ƒê√£ k·∫øt h√¥n</option>
                            </select>
                            <div id="partner-inputs" class="hidden grid grid-cols-2 gap-2">
                                <input type="text" id="inp-partner-name" placeholder="T√™n ng∆∞·ªùi ·∫•y" class="inp">
                                <input type="text" id="inp-partner-link" placeholder="Link Profile (FB...)" class="inp">
                            </div>
                        </div>
                    </div>

                    <!-- TAB: CONTACT -->
                    <div id="tab-contact" class="tab-content hidden space-y-4">
                        <div class="space-y-2 bg-slate-50 dark:bg-slate-800/50 p-4 rounded-xl">
                            <label class="lbl">S·ªë ƒëi·ªán tho·∫°i</label>
                            <div id="phone-list-editor" class="grid grid-cols-1 gap-2"></div>
                            <button type="button" onclick="addPhoneInput()" class="w-full py-2 border-2 border-dashed border-slate-300 text-slate-500 rounded-lg text-xs font-bold hover:bg-white hover:text-primary transition">+ Th√™m s·ªë m·ªõi</button>
                        </div>
                         <div><label class="lbl">Email (C√°ch nhau d·∫•u ph·∫©y)</label><input type="text" id="inp-emails" class="inp" placeholder="email1@gmail.com, email2@yahoo.com"></div>
                         <div><label class="lbl">Facebook (Link)</label><input type="text" id="inp-fb" class="inp"></div>
                         <div><label class="lbl">Zalo (SƒêT)</label><input type="text" id="inp-zalo" class="inp"></div>
                         <div><label class="lbl">Instagram (Link/User)</label><input type="text" id="inp-ig" class="inp"></div>
                         <div><label class="lbl">Telegram (User kh√¥ng @)</label><input type="text" id="inp-tele" class="inp"></div>
                         <div><label class="lbl">LinkedIn (Link)</label><input type="text" id="inp-linkedin" class="inp"></div>
                    </div>

                    <!-- TAB: CAREER -->
                    <div id="tab-career" class="tab-content hidden space-y-4">
                        <label class="lbl">D·ªØ li·ªáu JSON</label>
                        <textarea id="inp-career-json" rows="10" class="inp font-mono text-xs"></textarea>
                    </div>

                     <!-- TAB: BANK -->
                     <div id="tab-bank" class="tab-content hidden space-y-4">
                        <div class="flex gap-2">
                            <select id="api-bank-list" class="inp w-1/2"></select>
                            <input type="text" id="bank-acc-num" placeholder="S·ªë t√†i kho·∫£n" class="inp w-1/2">
                        </div>
                        <input type="text" id="bank-acc-name" placeholder="T√™n ch·ªß th·∫ª" class="inp">
                        <button type="button" onclick="addBank()" class="w-full btn-primary py-2 text-xs rounded-lg font-bold">Th√™m Ng√¢n h√†ng</button>
                        <div id="admin-bank-list" class="space-y-2 mt-4"></div>
                    </div>

                    <!-- TAB: PARTNERS -->
                    <div id="tab-partners" class="tab-content hidden space-y-4">
                        <div class="bg-slate-50 dark:bg-slate-800 p-4 rounded-xl space-y-3">
                            <label class="lbl">Th√™m/S·ª≠a ƒê·ªëi t√°c</label>
                            <input type="text" id="partner-logo-url" placeholder="Link ·∫£nh Logo" class="inp">
                            <input type="text" id="partner-link" placeholder="Link trang web" class="inp">
                            <button type="button" onclick="addPartner()" class="w-full btn-primary py-2 text-xs rounded-lg font-bold">Th√™m v√†o danh s√°ch</button>
                            <p class="text-[10px] text-slate-400 italic text-center">B·∫•m v√†o n√∫t X ƒë·ªÉ x√≥a, b·∫•m v√†o ·∫£nh ƒë·ªÉ s·ª≠a l·∫°i.</p>
                        </div>
                        <label class="lbl mt-4">Danh s√°ch hi·ªán t·∫°i</label>
                        <div id="admin-partner-list" class="grid grid-cols-2 gap-3"></div>
                    </div>

                    <!-- TAB: WEBSITE (META) -->
                    <div id="tab-website" class="tab-content hidden space-y-4">
                        <div class="p-4 bg-purple-50 dark:bg-purple-900/10 rounded-xl space-y-3">
                            <h4 class="font-bold text-purple-600">C·∫•u h√¨nh SEO & Hi·ªÉn th·ªã</h4>
                            <div>
                                <label class="lbl">Ti√™u ƒë·ªÅ trang (Title)</label>
                                <input type="text" id="meta-title-inp" class="inp" placeholder="VD: Nguy·ªÖn VƒÉn A - Profile">
                            </div>
                            <div>
                                <label class="lbl">M√¥ t·∫£ (Description)</label>
                                <textarea id="meta-desc-inp" rows="2" class="inp" placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ trang..."></textarea>
                            </div>
                            <div>
                                <label class="lbl">Icon trang (Favicon URL)</label>
                                <input type="text" id="meta-icon-inp" class="inp" placeholder="https://...">
                            </div>
                        </div>
                    </div>

                    <!-- TAB: MESSAGES -->
                    <div id="tab-messages" class="tab-content hidden space-y-4">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-bold">Danh s√°ch tin nh·∫Øn</h4>
                            <button type="button" onclick="loadAdminMessages()" class="text-xs bg-slate-200 dark:bg-slate-800 px-3 py-1 rounded hover:bg-slate-300">L√†m m·ªõi</button>
                        </div>
                        <div id="admin-messages-list" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                            <p class="text-center text-slate-500 text-sm">ƒêang t·∫£i...</p>
                        </div>
                    </div>

                    <!-- TAB: CONFIG -->
                    <div id="tab-config" class="tab-content hidden space-y-4">
                        <div class="p-4 bg-red-50 dark:bg-red-900/10 rounded-xl border border-red-100 dark:border-red-900/20 space-y-3">
                            <h4 class="font-bold text-red-500 text-sm">C·∫•u h√¨nh GitHub (L∆∞u tr·ªØ ·∫£nh)</h4>
                            <input type="password" id="gh-token" placeholder="Token" class="inp">
                            <input type="text" id="gh-owner" placeholder="Username" class="inp">
                            <input type="text" id="gh-repo" placeholder="Repository" class="inp">
                        </div>

                        <div class="p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100 dark:border-blue-900/20 space-y-3">
                            <h4 class="font-bold text-blue-500 text-sm">C·∫•u h√¨nh USB Key</h4>
                            <p class="text-[10px] text-slate-500">Nh·∫≠p m√£ b√≠ m·∫≠t b√™n d∆∞·ªõi. Tr√™n USB t·∫°o file .json ch·ª©a: {"key": "M√É_C·ª¶A_B·∫†N"}</p>
                            <div class="flex gap-2">
                                <input type="text" id="usb-secret-val" placeholder="Nh·∫≠p m√£ b√≠ m·∫≠t..." class="inp">
                                <button type="button" onclick="saveUSBConfig()" class="px-4 bg-blue-500 text-white rounded-lg font-bold text-xs">L∆∞u</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="p-4 border-t dark:border-white/10 bg-white dark:bg-slate-900 flex justify-end gap-3">
            <button onclick="window.closeModal('modal-admin')" class="px-6 py-2 rounded-xl text-slate-500 font-bold hover:bg-slate-100 dark:hover:bg-slate-800 transition">H·ªßy</button>
            <button onclick="window.saveProfile()" class="px-6 py-2 bg-primary text-white rounded-xl font-bold shadow-lg hover:bg-indigo-600 transition">L∆∞u Thay ƒê·ªïi</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div id="toast" class="fixed bottom-5 right-5 z-[1000] translate-y-20 opacity-0 transition-all duration-300">
    <div class="bg-slate-900 text-white dark:bg-white dark:text-slate-900 px-6 py-3 rounded-xl shadow-2xl flex items-center gap-3 font-bold text-sm">
        <i id="toast-icon" data-lucide="check-circle" class="w-5 h-5 text-green-500"></i>
        <span id="toast-msg">Th√¥ng b√°o</span>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, setDoc, updateDoc, getDoc, arrayUnion, arrayRemove, increment, collection, getDocs, addDoc, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // --- C·∫§U H√åNH FIREBASE ---
    const firebaseConfig = {
        apiKey: "AIzaSyCLCcgaoW9gNYhKk0c0gDWC6i5mKVTN4XE", 
        authDomain: "profile-d1214.firebaseapp.com",
        projectId: "profile-d1214",
        storageBucket: "profile-d1214.firebasestorage.app",
        messagingSenderId: "914980131889",
        appId: "1:914980131889:web:72f8da15c42dbee671b110"
    };
    
    const ADMIN_EMAILS = ["sonlyhongduc@gmail.com"]; 

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    let currentUser = null;
    let isAdmin = false;
    let isUSBAdmin = false;
    let profileData = {};
    let ghConfig = {};
    let listBanks = [];
    let listPartners = [];
    let cropper = null;
    let croppedAvatarBase64 = null;
    const carrierLogos = {
        'viettel': 'https://upload.wikimedia.org/wikipedia/commons/4/4e/Viettel_logo_2021.png',
        'vinaphone': '/img/vina.png',
        'mobifone': '/img/mobi.PNG',
        'vietnamobile': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6b/Vietnamobile_Logo.png/800px-Vietnamobile_Logo.png',
        'gmobile': 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Gmobile_logo.png/800px-Gmobile_logo.png',
        'itel': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/23/Logo_Itel.png/800px-Logo_Itel.png'
    };

    // --- AUTH ---
    onAuthStateChanged(auth, async (user) => {
        currentUser = user;
        if(user) {
            await setDoc(doc(db, "users", user.uid), {
                uid: user.uid,
                displayName: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                lastSeen: new Date().toISOString()
            }, { merge: true });

            const adminRef = doc(db, "settings", "admins");
            const adminSnap = await getDoc(adminRef);
            const serverAdmins = adminSnap.exists() ? adminSnap.data().emails : [];
            isAdmin = ADMIN_EMAILS.includes(user.email) || (serverAdmins && serverAdmins.includes(user.email));

            checkAdminUI();
        } else {
            isAdmin = false;
            checkAdminUI();
        }
        renderAuthUI();
        checkFollowStatus();
    });

    // --- USB LOGIN ---
    const usbInput = document.getElementById('usb-key-input');
    usbInput.addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (event) => {
            try {
                const content = JSON.parse(event.target.result);
                if (content.key) {
                    const usbRef = doc(db, "settings", "usb_config");
                    const snap = await getDoc(usbRef);
                    if (snap.exists() && snap.data().secret === content.key) {
                        isUSBAdmin = true;
                        showToast("ƒê√£ x√°c th·ª±c USB Key th√†nh c√¥ng!");
                        checkAdminUI();
                    } else {
                        showToast("USB Key kh√¥ng h·ª£p l·ªá!", true);
                    }
                }
            } catch (err) { showToast("L·ªói ƒë·ªçc file USB!", true); }
        };
        reader.readAsText(file);
        usbInput.value = ''; 
    });

    function checkAdminUI() {
        if (isAdmin || isUSBAdmin) {
            document.getElementById('admin-btn').classList.remove('hidden');
            document.getElementById('manager-btn').classList.remove('hidden');
            if(isAdmin) loadGithubConfig();
        } else {
            document.getElementById('admin-btn').classList.add('hidden');
            document.getElementById('manager-btn').classList.add('hidden');
        }
    }

    window.saveUSBConfig = async () => {
        const val = document.getElementById('usb-secret-val').value;
        if (!val) return;
        await setDoc(doc(db, "settings", "usb_config"), { secret: val });
        showToast("ƒê√£ l∆∞u m√£ USB Key!");
    }

    // --- IP & GEO FETCH ---
    function loadNetworkInfo() {
        // Get IP
        fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                document.getElementById('user-ip').innerText = data.ip;
            })
            .catch(() => document.getElementById('user-ip').innerText = "Kh√¥ng x√°c ƒë·ªãnh");

        // Get Geo
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude.toFixed(4);
                    const lon = position.coords.longitude.toFixed(4);
                    document.getElementById('user-coords').innerText = `${lat}, ${lon}`;
                },
                (error) => {
                     document.getElementById('user-coords').innerText = "Kh√≥c hehe";
                }
            );
        } else {
            document.getElementById('user-coords').innerText = "Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£";
        }
    }
    loadNetworkInfo();

    // --- SCROLL REVEAL OBSERVER ---
    const observerOptions = {
        root: null,
        rootMargin: '0px',
        threshold: 0.1
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');
            }
        });
    }, observerOptions);

    function initScrollReveal() {
        document.querySelectorAll('.reveal-on-scroll').forEach(el => {
            observer.observe(el);
        });
    }

    // --- DATA SYNC ---
    const profileRef = doc(db, "profile_data", "main");
    
    onSnapshot(profileRef, (docSnap) => {
        document.getElementById('global-loading').classList.add('opacity-0', 'pointer-events-none');
        if (docSnap.exists()) {
            profileData = docSnap.data();
            renderProfile();
            initScrollReveal(); // Re-init observer on new data render
        }
    });

    // --- RENDER ---
    function renderProfile() {
        // Meta & Title
        if(profileData.meta) {
            document.title = profileData.meta.title || profileData.name;
            document.getElementById('meta-desc').setAttribute('content', profileData.meta.description || '');
            if(profileData.meta.favicon) document.getElementById('meta-icon').href = profileData.meta.favicon;
        } else {
            document.title = `${profileData.name} - Profile`;
        }

        // --- PWA DYNAMIC MANIFEST GENERATION ---
        const manifestLink = document.getElementById('dynamic-manifest');
        const currentIcon = profileData.avatar || "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";
        const manifestObj = {
            "name": profileData.name || "Profile C√° Nh√¢n",
            "short_name": profileData.nickname || "Profile",
            "start_url": location.href,
            "display": "standalone",
            "background_color": "#f8fafc",
            "theme_color": "#6366f1",
            "icons": [
                { "src": currentIcon, "sizes": "192x192", "type": "image/png" },
                { "src": currentIcon, "sizes": "512x512", "type": "image/png" }
            ]
        };
        const stringManifest = JSON.stringify(manifestObj);
        const blob = new Blob([stringManifest], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        manifestLink.setAttribute('href', manifestURL);
        // ----------------------------------------

        document.getElementById('profile-name').innerText = profileData.name || "No Name";
        document.getElementById('nav-nickname').innerText = profileData.nickname || "User";
        if(profileData.avatar) {
            document.getElementById('profile-avatar').src = profileData.avatar;
            document.getElementById('nav-avatar').src = profileData.avatar;
        }
        if(profileData.nickname) {
            const badge = document.getElementById('profile-nickname-badge');
            badge.innerText = profileData.nickname;
            badge.classList.remove('hidden');
        }
        
        document.getElementById('profile-bio').innerText = profileData.bio || "Ch∆∞a c·∫≠p nh·∫≠t ti·ªÉu s·ª≠.";
        document.getElementById('stat-followers').innerText = (profileData.followers || []).length;
        document.getElementById('stat-views').innerText = profileData.views || 0;

        const relEl = document.getElementById('relationship-display');
        if (profileData.relationship?.status && profileData.relationship.status !== 'ƒê·ªôc th√¢n') {
            relEl.classList.remove('hidden');
            let html = `${profileData.relationship.status}`;
            if(profileData.relationship.partnerName) {
                html += ` v·ªõi <a href="${profileData.relationship.partnerLink || '#'}" target="_blank" class="font-black hover:underline cursor-pointer transition-all">${profileData.relationship.partnerName}</a>`;
            }
            document.getElementById('rel-status').innerHTML = html;
        } else {
            relEl.classList.add('hidden');
        }

        document.getElementById('info-dob').innerText = formatDate(profileData.dob);
        document.getElementById('info-gender').innerText = profileData.gender || "---";
        document.getElementById('info-hometown').innerText = profileData.hometown?.full || "---";

        const socialMap = {
            facebook: { icon: 'facebook', color: 'text-blue-600' },
            zalo: { icon: 'phone', color: 'text-blue-500' },
            instagram: { icon: 'instagram', color: 'text-pink-600' },
            telegram: { icon: 'send', color: 'text-sky-500' },
            linkedin: { icon: 'linkedin', color: 'text-blue-700' },
        };
        let socialHtml = '';
        if(profileData.socials) {
            Object.keys(profileData.socials).forEach(key => {
                const val = profileData.socials[key];
                if(val) {
                    const meta = socialMap[key] || { icon: 'link', color: 'text-slate-500' };
                    let link = val;
                    if(key === 'zalo') link = `https://zalo.me/${val}`;
                    if(key === 'telegram') link = `https://t.me/${val}`;
                    socialHtml += `
                    <a href="${link}" target="_blank" class="p-3 bg-white dark:bg-slate-800 rounded-full shadow hover:-translate-y-1 transition ${meta.color}">
                        <i data-lucide="${meta.icon}" class="w-5 h-5"></i>
                    </a>`;
                }
            });
        }
        document.getElementById('social-grid').innerHTML = socialHtml;

        // BANK RENDER
        const bankContainer = document.getElementById('bank-list');
        bankContainer.innerHTML = (profileData.banks || []).map(b => `
            <div class="bank-card p-3 rounded-xl flex items-center justify-between shadow-lg relative overflow-hidden group bg-white dark:bg-slate-900 border dark:border-white/5">
                <div class="flex items-center gap-4 z-10">
                    <div class="w-12 h-12 bg-white rounded-lg shadow-inner flex items-center justify-center shrink-0 overflow-hidden relative">
                        <img src="${b.logo}" class="w-full h-full object-contain p-1">
                    </div>
                    <div>
                        <p class="text-[10px] uppercase font-bold text-slate-400 tracking-wider mb-0.5">${b.shortName}</p>
                        <p class="font-mono font-bold text-lg tracking-normal text-slate-800 dark:text-white select-all">${b.number}</p>
                        <p class="text-[10px] font-bold uppercase text-slate-500">${b.owner}</p>
                    </div>
                </div>
                <button onclick="window.copyToClip('${b.number}')" class="p-2 bg-slate-100 dark:bg-slate-800 hover:bg-primary hover:text-white rounded-lg z-10 transition">
                    <i data-lucide="copy" class="w-4 h-4"></i>
                </button>
                <div class="absolute right-0 bottom-0 opacity-5 pointer-events-none">
                   <img src="${b.logo}" class="w-32 h-32 -mb-8 -mr-8 object-contain">
                </div>
            </div>
        `).join('');

        const careerContainer = document.getElementById('career-timeline');
        const items = [...(profileData.education || []), ...(profileData.work || [])];
        if(items.length === 0) careerContainer.innerHTML = '<p class="text-sm text-slate-400 italic">Ch∆∞a c·∫≠p nh·∫≠t th√¥ng tin.</p>';
        else {
            careerContainer.innerHTML = items.map(item => `
                <div class="relative mb-6 last:mb-0">
                    <span class="absolute -left-[33px] w-4 h-4 rounded-full bg-primary border-4 border-white dark:border-slate-800"></span>
                    <h4 class="font-bold text-slate-800 dark:text-white">${item.title}</h4>
                    <p class="text-xs font-bold text-primary mb-1">${item.org}</p>
                    <p class="text-xs text-slate-500">${item.time} ‚Ä¢ ${item.status || ''}</p>
                </div>
            `).join('');
        }

        const achContainer = document.getElementById('achievement-list');
        if(!profileData.achievements || profileData.achievements.length === 0) {
            achContainer.innerHTML = '<p class="text-sm text-slate-400 italic col-span-2 text-center">Ch∆∞a c√≥ th√†nh t·ª±u n√†o.</p>';
        } else {
            achContainer.innerHTML = profileData.achievements.map(a => `
                <div class="p-4 bg-white dark:bg-slate-800 rounded-xl border dark:border-white/5 flex items-start gap-3">
                    <div class="p-2 bg-yellow-100 dark:bg-yellow-900/20 text-yellow-600 rounded-lg">
                        <i data-lucide="award" class="w-5 h-5"></i>
                    </div>
                    <div>
                        <h5 class="font-bold text-sm">${a.title}</h5>
                        <span class="text-[10px] font-bold px-2 py-0.5 bg-slate-100 dark:bg-slate-700 rounded text-slate-500">${a.date}</span>
                    </div>
                </div>
            `).join('');
        }

        const partnerSec = document.getElementById('partners-section');
        const partnerGrid = document.getElementById('partners-grid');
        if(profileData.partners && profileData.partners.length > 0) {
            partnerSec.classList.remove('hidden');
            partnerGrid.innerHTML = profileData.partners.map(p => `
                <a href="${p.link}" target="_blank" class="block group">
                    <img src="${p.logo}" class="h-8 md:h-10 w-auto object-contain transition group-hover:scale-110">
                </a>
            `).join('');
        } else {
            partnerSec.classList.add('hidden');
        }

        checkFollowStatus(); 
        lucide.createIcons();
    }

    // --- CROPPER LOGIC ---
    const imageToCrop = document.getElementById('image-to-crop');
    document.getElementById('inp-avatar').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (evt) => {
                imageToCrop.src = evt.target.result;
                document.getElementById('modal-crop').classList.remove('hidden');
                if(cropper) cropper.destroy();
                cropper = new Cropper(imageToCrop, {
                    aspectRatio: 1,
                    viewMode: 1,
                    autoCropArea: 1,
                });
            }
            reader.readAsDataURL(file);
        }
        e.target.value = ''; 
    });

    window.confirmCrop = () => {
        if(!cropper) return;
        croppedAvatarBase64 = cropper.getCroppedCanvas({ width: 400, height: 400 }).toDataURL();
        document.getElementById('preview-avatar').src = croppedAvatarBase64;
        window.closeModal('modal-crop');
        showToast("ƒê√£ c·∫Øt ·∫£nh xong! Nh·∫•n L∆∞u ƒë·ªÉ c·∫≠p nh·∫≠t.");
    }

    // --- CONTACT MODAL ---
    window.showContactModal = (type) => {
        const modal = document.getElementById('modal-contact');
        const list = document.getElementById('contact-list');
        const title = document.getElementById('contact-title');
        
        modal.classList.remove('hidden');
        list.innerHTML = '';
        
        if (type === 'phone') {
            title.innerText = "G·ªçi ƒëi·ªán tho·∫°i";
            const phones = profileData.phones || [];

            if(phones.length === 0) list.innerHTML = '<p class="text-center text-slate-500">Ch∆∞a c√≥ s·ªë ƒëi·ªán tho·∫°i.</p>';
            else {
                list.innerHTML = phones.map(p => {
                    const carrierKey = p.carrier ? p.carrier.toLowerCase().trim() : '';
                    const logoUrl = carrierLogos[carrierKey] || '';
                    
                    let carrierDisplayHtml = '';
                    if(logoUrl) {
                        carrierDisplayHtml = `<img src="${logoUrl}" class="h-6 w-12 object-contain bg-white rounded px-1">`;
                    } else {
                        carrierDisplayHtml = `<span class="text-[10px] font-black uppercase px-2 py-0.5 rounded shadow-sm w-12 text-center bg-slate-500 text-white">${p.carrier || 'Sim'}</span>`;
                    }
                    
                    return `
                    <a href="tel:${p.number}" class="flex items-center justify-between p-3 bg-slate-50 dark:bg-slate-800 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 transition group">
                        <div class="flex items-center gap-3">
                            ${carrierDisplayHtml}
                            <span class="font-bold text-lg text-slate-700 dark:text-white">${p.number}</span>
                        </div>
                        <i data-lucide="phone-call" class="w-5 h-5 text-green-500 group-hover:scale-110 transition"></i>
                    </a>`;
                }).join('');
            }
        } else {
            title.innerText = "G·ª≠i Email";
            const emails = (profileData.email || "").split(',').map(e => e.trim()).filter(e=>e);
            if(emails.length === 0) list.innerHTML = '<p>Ch∆∞a c√≥ email.</p>';
            else {
                list.innerHTML = emails.map(e => `
                    <a href="mailto:${e}" class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-xl hover:bg-slate-100 dark:hover:bg-slate-700 transition">
                         <span class="font-bold text-sm truncate">${e}</span>
                        <i data-lucide="send" class="w-5 h-5 text-blue-500"></i>
                    </a>`).join('');
            }
        }
        lucide.createIcons();
    }

    window.showContactForm = () => {
         document.getElementById('modal-send-msg').classList.remove('hidden');
         if(currentUser) {
             document.getElementById('msg-name').value = currentUser.displayName || '';
             document.getElementById('msg-email').value = currentUser.email || '';
             document.getElementById('msg-email-group').classList.add('hidden'); 
         } else {
             document.getElementById('msg-email-group').classList.remove('hidden');
         }
    }
    window.toggleAnon = () => {
        const isAnon = document.getElementById('msg-anon').checked;
        const nameInp = document.getElementById('msg-name');
        const emailGrp = document.getElementById('msg-email-group');
        if(isAnon) {
            nameInp.value = "Ng∆∞·ªùi ·∫©n danh";
            nameInp.disabled = true;
            emailGrp.classList.add('hidden');
        } else {
            nameInp.value = currentUser ? currentUser.displayName : "";
            nameInp.disabled = false;
            if(!currentUser) emailGrp.classList.remove('hidden');
        }
    }
    window.sendContact = async () => {
        const content = document.getElementById('msg-content').value;
        if(!content) { showToast("Vui l√≤ng nh·∫≠p n·ªôi dung!", true); return; }
        
        const isAnon = document.getElementById('msg-anon').checked;
        let data = {
            content: content,
            timestamp: new Date().toISOString(),
            isAnon: isAnon
        };

        if(isAnon) {
            data.name = "·∫®n danh";
        } else {
            data.name = document.getElementById('msg-name').value;
            data.email = currentUser ? currentUser.email : document.getElementById('msg-email').value;
        }

        try {
            await addDoc(collection(db, "messages"), data);
            showToast("Tin nh·∫Øn ƒë√£ ƒë∆∞·ª£c g·ª≠i!");
            window.closeModal('modal-send-msg');
            document.getElementById('contact-form').reset();
        } catch(e) {
            showToast("L·ªói g·ª≠i tin nh·∫Øn", true);
        }
    }

    // --- AUTH UI ---
    function renderAuthUI() {
        const container = document.getElementById('auth-section');
        if (currentUser) {
            container.innerHTML = `
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.doLogout()">
                    <img src="${currentUser.photoURL}" class="w-8 h-8 rounded-full border border-slate-200">
                </div>
            `;
        } else {
            container.innerHTML = `<button onclick="window.doLogin()" class="px-4 py-1.5 bg-primary text-white text-xs font-bold rounded-full shadow hover:bg-indigo-600">ƒêƒÉng nh·∫≠p</button>`;
        }
    }
    window.doLogin = () => signInWithPopup(auth, provider);
    window.doLogout = () => signOut(auth).then(()=> location.reload());

    // --- ADMIN OPEN ---
    window.openEditModal = async () => {
        document.getElementById('modal-admin').classList.remove('hidden');
        document.getElementById('preview-avatar').src = profileData.avatar || '';
        document.getElementById('inp-name').value = profileData.name || '';
        document.getElementById('inp-nickname').value = profileData.nickname || '';
        document.getElementById('inp-bio').value = profileData.bio || '';
        document.getElementById('inp-dob').value = profileData.dob || '';
        document.getElementById('inp-gender').value = profileData.gender || 'Nam';
        
        // Hometown Load
        await fetchProvinces();
        const savedHometown = profileData.hometown?.full || '';
        document.getElementById('inp-hometown-full').value = savedHometown;
        const citySelect = document.getElementById('api-city');
        for(let i=0; i<citySelect.options.length; i++) {
            if(citySelect.options[i].dataset.name === savedHometown) {
                citySelect.selectedIndex = i;
                break;
            }
        }

        if(profileData.meta) {
            document.getElementById('meta-title-inp').value = profileData.meta.title || '';
            document.getElementById('meta-desc-inp').value = profileData.meta.description || '';
            document.getElementById('meta-icon-inp').value = profileData.meta.favicon || '';
        }

        if(profileData.relationship) {
            document.getElementById('inp-rel-status').value = profileData.relationship.status;
            document.getElementById('inp-partner-name').value = profileData.relationship.partnerName || '';
            document.getElementById('inp-partner-link').value = profileData.relationship.partnerLink || '';
            togglePartnerInput();
        }

        const phones = profileData.phones || [];
        document.getElementById('phone-list-editor').innerHTML = '';
        phones.forEach(p => addPhoneInput(p.number, p.carrier));
        
        document.getElementById('inp-emails').value = profileData.email || '';
        if(profileData.socials) {
            document.getElementById('inp-fb').value = profileData.socials.facebook || '';
            document.getElementById('inp-zalo').value = profileData.socials.zalo || '';
            document.getElementById('inp-ig').value = profileData.socials.instagram || '';
            document.getElementById('inp-tele').value = profileData.socials.telegram || '';
            document.getElementById('inp-linkedin').value = profileData.socials.linkedin || '';
        }

        const careerData = [...(profileData.education || []), ...(profileData.work || []), ...(profileData.achievements || [])];
        document.getElementById('inp-career-json').value = JSON.stringify({
            education: profileData.education || [],
            work: profileData.work || [],
            achievements: profileData.achievements || []
        }, null, 2);

        listBanks = profileData.banks || [];
        renderAdminBanks();
        loadBankList();

        listPartners = profileData.partners || [];
        renderAdminPartners();
        
        const usbSnap = await getDoc(doc(db, "settings", "usb_config"));
        if(usbSnap.exists()) document.getElementById('usb-secret-val').value = usbSnap.data().secret || '';

        // Load Messages
        loadAdminMessages();
    }

    window.loadAdminMessages = async () => {
        const list = document.getElementById('admin-messages-list');
        list.innerHTML = '<p class="text-center text-xs">ƒêang t·∫£i...</p>';
        try {
            const q = query(collection(db, "messages"), orderBy("timestamp", "desc"), limit(20));
            const snap = await getDocs(q);
            if(snap.empty) {
                list.innerHTML = '<p class="text-center text-slate-400 text-xs">Ch∆∞a c√≥ tin nh·∫Øn n√†o.</p>';
                return;
            }
            list.innerHTML = '';
            snap.forEach(doc => {
                const msg = doc.data();
                const d = new Date(msg.timestamp).toLocaleString('vi-VN');
                list.innerHTML += `
                    <div class="p-3 bg-slate-50 dark:bg-slate-800 rounded border dark:border-white/10">
                        <div class="flex justify-between items-start">
                            <span class="font-bold text-sm text-primary">${msg.name}</span>
                            <span class="text-[10px] text-slate-400">${d}</span>
                        </div>
                        <p class="text-xs text-slate-500 italic mb-1">${msg.email || 'No Email'}</p>
                        <p class="text-sm bg-white dark:bg-slate-900 p-2 rounded mt-1">${msg.content}</p>
                    </div>
                `;
            });
        } catch (error) {
            list.innerHTML = '<p class="text-red-500 text-xs">L·ªói t·∫£i tin nh·∫Øn.</p>';
        }
    }

    // --- SAVE PROFILE ---
    window.saveProfile = async () => {
        const btn = document.querySelector('#modal-admin button.bg-primary');
        btn.innerText = "ƒêang l∆∞u...";
        
        try {
            const token = document.getElementById('gh-token').value;
            const owner = document.getElementById('gh-owner').value;
            const repo = document.getElementById('gh-repo').value;
            if(token && owner && repo) {
                await setDoc(doc(db, "settings", "github_config"), { token, owner, repo });
                ghConfig = { token, owner, repo };
            }

            let avatarUrl = profileData.avatar;
            if(croppedAvatarBase64 && ghConfig.token) {
                const content = croppedAvatarBase64.split(',')[1];
                const path = `avatars/${Date.now()}_avatar.png`;
                const url = `https://api.github.com/repos/${ghConfig.owner}/${ghConfig.repo}/contents/${path}`;
                const res = await fetch(url, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${ghConfig.token}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: "Update Avatar", content: content, branch: 'main' })
                });
                if(res.ok) {
                    const data = await res.json();
                    avatarUrl = data.content.download_url;
                }
            }

            const jsonRaw = document.getElementById('inp-career-json').value;
            let careerData = {};
            try { careerData = JSON.parse(jsonRaw); } catch(e) { alert("JSON L·ªói!"); return; }

            const phoneElements = document.querySelectorAll('#phone-list-editor .phone-row');
            const phones = Array.from(phoneElements).map(row => ({
                carrier: row.querySelector('.carrier-select').value,
                number: row.querySelector('.phone-inp').value
            })).filter(x => x.number);
            
            const newData = {
                name: document.getElementById('inp-name').value,
                nickname: document.getElementById('inp-nickname').value,
                bio: document.getElementById('inp-bio').value,
                dob: document.getElementById('inp-dob').value,
                gender: document.getElementById('inp-gender').value,
                hometown: { full: document.getElementById('inp-hometown-full').value },
                avatar: avatarUrl,
                meta: {
                    title: document.getElementById('meta-title-inp').value,
                    description: document.getElementById('meta-desc-inp').value,
                    favicon: document.getElementById('meta-icon-inp').value
                },
                relationship: {
                    status: document.getElementById('inp-rel-status').value,
                    partnerName: document.getElementById('inp-partner-name').value,
                    partnerLink: document.getElementById('inp-partner-link').value
                },
                email: document.getElementById('inp-emails').value,
                phones: phones,
                socials: {
                    facebook: document.getElementById('inp-fb').value,
                    zalo: document.getElementById('inp-zalo').value,
                    instagram: document.getElementById('inp-ig').value,
                    telegram: document.getElementById('inp-tele').value,
                    linkedin: document.getElementById('inp-linkedin').value,
                },
                banks: listBanks,
                partners: listPartners,
                education: careerData.education || [],
                work: careerData.work || [],
                achievements: careerData.achievements || []
            };

            await setDoc(profileRef, newData, { merge: true });
            showToast("ƒê√£ c·∫≠p nh·∫≠t Profile!");
            window.closeModal('modal-admin');
            croppedAvatarBase64 = null; 

        } catch(e) {
            showToast("L·ªói: " + e.message, true);
            console.error(e);
        } finally {
            btn.innerText = "L∆∞u Thay ƒê·ªïi";
        }
    }

    // --- ADMIN HELPERS ---
    window.addPhoneInput = (val = '', carrier = 'Viettel') => {
        const container = document.getElementById('phone-list-editor');
        const div = document.createElement('div');
        div.className = 'phone-row flex gap-2 items-center bg-white p-2 rounded shadow-sm';
        // Adjusted width for select box here (w-[110px])
        div.innerHTML = `
            <select class="inp w-[110px] shrink-0 carrier-select text-xs">
                <option value="Viettel" ${carrier === 'Viettel' ? 'selected' : ''}>Viettel</option>
                <option value="Vinaphone" ${carrier === 'Vinaphone' ? 'selected' : ''}>Vinaphone</option>
                <option value="Mobifone" ${carrier === 'Mobifone' ? 'selected' : ''}>Mobifone</option>
                <option value="Vietnamobile" ${carrier === 'Vietnamobile' ? 'selected' : ''}>Vietnamobile</option>
                <option value="Gmobile" ${carrier === 'Gmobile' ? 'selected' : ''}>Gmobile</option>
                <option value="Itel" ${carrier === 'Itel' ? 'selected' : ''}>Itel/Kh√°c</option>
            </select>
            <input type="text" value="${val}" class="inp phone-inp flex-1 font-bold text-slate-700 min-w-0" placeholder="09xxxx">
            <button type="button" onclick="this.parentElement.remove()" class="p-2 text-red-500 hover:bg-red-50 rounded"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
        `;
        container.appendChild(div);
        lucide.createIcons();
    }

    window.addPartner = () => {
        const logo = document.getElementById('partner-logo-url').value;
        const link = document.getElementById('partner-link').value;
        if(!logo) return;
        listPartners.push({ logo, link });
        renderAdminPartners();
        document.getElementById('partner-logo-url').value = '';
        document.getElementById('partner-link').value = '';
    }
    function renderAdminPartners() {
        document.getElementById('admin-partner-list').innerHTML = listPartners.map((p, i) => `
            <div class="relative p-2 border rounded flex items-center justify-center bg-white h-20 group cursor-pointer" onclick="editPartner(${i})">
                <img src="${p.logo}" class="h-full object-contain">
                <button onclick="event.stopPropagation(); removePartner(${i})" class="absolute top-1 right-1 bg-red-500 text-white w-5 h-5 rounded-full text-xs flex items-center justify-center">x</button>
                <div class="absolute inset-0 bg-black/10 hidden group-hover:flex items-center justify-center text-xs font-bold text-white">S·ª≠a</div>
            </div>
        `).join('');
    }
    window.removePartner = (i) => { listPartners.splice(i, 1); renderAdminPartners(); }
    window.editPartner = (i) => {
        const p = listPartners[i];
        document.getElementById('partner-logo-url').value = p.logo;
        document.getElementById('partner-link').value = p.link;
        listPartners.splice(i, 1);
        renderAdminPartners();
        showToast("ƒê√£ ƒë∆∞a th√¥ng tin l√™n √¥ nh·∫≠p ƒë·ªÉ s·ª≠a.");
    }

    window.openManagerModal = async () => {
         const modal = document.getElementById('modal-manager');
         modal.classList.remove('hidden');
         const list = document.getElementById('manager-list');
         list.innerHTML = '<div class="text-center p-4"><div class="loader"></div></div>';
         try {
            const snap = await getDocs(collection(db, "users"));
            let html = '';
            snap.forEach(d => {
                const u = d.data();
                html += `
                <div class="flex items-center gap-3 p-3 border-b dark:border-white/5">
                    <img src="${u.photoURL}" class="w-10 h-10 rounded-full bg-slate-100">
                    <div class="flex-1 min-w-0">
                        <p class="font-bold text-sm truncate">${u.displayName}</p>
                        <p class="text-xs text-slate-500 truncate">${u.email}</p>
                    </div>
                </div>`;
            });
            list.innerHTML = html;
         } catch(e) { list.innerHTML = "L·ªói t·∫£i danh s√°ch."; }
    }

    function checkFollowStatus() {
        const btn = document.getElementById('follow-btn');
        if (!currentUser) {
            btn.innerHTML = `<i data-lucide="user-plus" class="w-4 h-4"></i> Theo d√µi`;
            btn.classList.remove('bg-green-600');
            return;
        }
        const followers = profileData.followers || [];
        const isFollowing = followers.includes(currentUser.uid);
        if (isFollowing) {
            btn.innerHTML = `<i data-lucide="check" class="w-4 h-4"></i> ƒêang theo d√µi`;
            btn.classList.add('bg-green-600', 'text-white');
            btn.classList.remove('bg-slate-900', 'dark:bg-white');
        } else {
            btn.innerHTML = `<i data-lucide="user-plus" class="w-4 h-4"></i> Theo d√µi`;
            btn.classList.remove('bg-green-600');
            btn.classList.add('bg-slate-900', 'dark:bg-white');
        }
        lucide.createIcons();
    }
    window.toggleFollow = async () => {
        if (!currentUser) { window.doLogin(); return; }
        const uid = currentUser.uid;
        const followers = profileData.followers || [];
        if (followers.includes(uid)) {
            await updateDoc(profileRef, { followers: arrayRemove(uid) });
            showToast("ƒê√£ h·ªßy theo d√µi");
        } else {
            await updateDoc(profileRef, { followers: arrayUnion(uid) });
            showToast("ƒê√£ theo d√µi!");
        }
    }

    // --- UTILS ---
    window.closeModal = (id) => document.getElementById(id).classList.add('hidden');
    window.toggleTheme = () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
    }
    if (localStorage.theme === 'dark') document.documentElement.classList.add('dark');

    window.copyToClip = (text) => { navigator.clipboard.writeText(text); showToast('ƒê√£ sao ch√©p!'); }
    function formatDate(dateStr) { if (!dateStr) return ""; const [y, m, d] = dateStr.split('-'); return `${d}/${m}/${y}`; }
    function showToast(msg, isError = false) {
        const t = document.getElementById('toast');
        document.getElementById('toast-msg').innerText = msg;
        const icon = document.getElementById('toast-icon');
        if(isError) { icon.classList.replace('text-green-500','text-red-500'); icon.setAttribute('data-lucide','alert-triangle'); }
        else { icon.classList.replace('text-red-500','text-green-500'); icon.setAttribute('data-lucide','check-circle'); }
        lucide.createIcons();
        t.classList.remove('translate-y-20', 'opacity-0');
        setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
    }
    
    // --- API HELPERS ---
    async function fetchProvinces() { 
        const res = await fetch('https://esgoo.net/api-tinhthanh/1/0.htm'); 
        const data = await res.json(); 
        if(data.error === 0) {
            document.getElementById('api-city').innerHTML = '<option value="">-- Ch·ªçn T·ªânh/Th√†nh ph·ªë --</option>' + data.data.map(p => `<option value="${p.id}" data-name="${p.full_name}">${p.full_name}</option>`).join(''); 
        }
    }
    
    window.updateHometownStr = () => { 
        const c = document.getElementById('api-city'); 
        const name = c.options[c.selectedIndex]?.dataset.name || '';
        document.getElementById('inp-hometown-full').value = name; 
    }

    async function loadBankList() { try { const res = await fetch('https://api.vietqr.io/v2/banks'); const data = await res.json(); if(data.code === "00") document.getElementById('api-bank-list').innerHTML = data.data.map(b => `<option value='${JSON.stringify({shortName: b.shortName, logo: b.logo})}'>${b.shortName}</option>`).join(''); } catch(e) {} }
    window.addBank = () => { const meta = JSON.parse(document.getElementById('api-bank-list').value); const num = document.getElementById('bank-acc-num').value; const owner = document.getElementById('bank-acc-name').value; if(!num) return; listBanks.push({ ...meta, number: num, owner }); renderAdminBanks(); document.getElementById('bank-acc-num').value = ''; }
    function renderAdminBanks() { document.getElementById('admin-bank-list').innerHTML = listBanks.map((b, i) => `<div class="flex items-center justify-between p-2 bg-slate-100 dark:bg-slate-800 rounded"><div class="flex items-center gap-2"><img src="${b.logo}" class="w-6 h-6 object-contain bg-white"><span class="text-xs font-bold">${b.shortName} - ${b.number}</span></div><button onclick="removeBank(${i})" class="text-red-500 text-xs">X√≥a</button></div>`).join(''); }
    window.removeBank = (i) => { listBanks.splice(i, 1); renderAdminBanks(); }
    
    window.switchTab = (tabName) => { document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden')); document.getElementById('tab-' + tabName).classList.remove('hidden'); document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('bg-white', 'dark:bg-white/5', 'shadow-sm')); event.target.classList.add('bg-white', 'dark:bg-white/5', 'shadow-sm'); }
    window.togglePartnerInput = () => { const val = document.getElementById('inp-rel-status').value; document.getElementById('partner-inputs').classList.toggle('hidden', val === 'ƒê·ªôc th√¢n'); }
    async function loadGithubConfig() { const s = await getDoc(doc(db, "settings", "github_config")); if(s.exists()) { ghConfig = s.data(); document.getElementById('gh-token').value = ghConfig.token || ''; document.getElementById('gh-owner').value = ghConfig.owner || ''; document.getElementById('gh-repo').value = ghConfig.repo || ''; } }
    
    lucide.createIcons();
</script>
<style>
    .inp { width: 100%; padding: 0.5rem 1rem; border-radius: 0.5rem; border: 1px solid #e2e8f0; background-color: #f8fafc; outline: none; font-size: 0.875rem; }
    .dark .inp { background-color: #1e293b; border-color: rgba(255,255,255,0.1); color: white; }
    .inp:focus { border-color: #6366f1; }
    .lbl { display: block; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; color: #64748b; margin-bottom: 0.25rem; }
    .btn-primary { background-color: #6366f1; color: white; }
    .loader { width: 20px; height: 20px; border: 3px solid #e2e8f0; border-bottom-color: #6366f1; border-radius: 50%; display: inline-block; animation: rotation 1s linear infinite; }
    @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</body>
</html>
